/*
Formalizr v. 1.0.0.3
Copyright (C) 2014-2019 www.dennisbabkin.com. All Rights Reserved.

This is an Open Source project. It is minified for efficiency.
To download readable source code, go to:
 https://github.com/dennisbabkin/Formalizr
*/

gl={gnThisTabID:null,gstrSelTabId:null,gSngltnPrmpts:{strSavedOK:null,strRemovedOK:null,strImportedOK:null,strSavedErr:null,strXcptsSelType_0:null,strXcptsSelType_1:null,strXcptsSelType_2:null,strXcptsSelType_3:null,strXcptsSelType_4:null,strXcptsUsesRegExp:null,loadSingletons:function(){if(this.strSavedOK===null){this.strSavedOK=chrome.i18n.getMessage("msg_save_ok")}if(this.strRemovedOK===null){this.strRemovedOK=chrome.i18n.getMessage("msg_remove_ok")}if(this.strImportedOK===null){this.strImportedOK=chrome.i18n.getMessage("msg_import_ok")}if(this.strSavedErr===null){this.strSavedErr=chrome.i18n.getMessage("msg_save_err")}if(this.strXcptsSelType_0===null){this.strXcptsSelType_0=chrome.i18n.getMessage("sel_XcptsSelType_0")}if(this.strXcptsSelType_1===null){this.strXcptsSelType_1=chrome.i18n.getMessage("sel_XcptsSelType_1")}if(this.strXcptsSelType_2===null){this.strXcptsSelType_2=chrome.i18n.getMessage("sel_XcptsSelType_2")}if(this.strXcptsSelType_3===null){this.strXcptsSelType_3=chrome.i18n.getMessage("sel_XcptsSelType_3")}if(this.strXcptsSelType_4===null){this.strXcptsSelType_4=chrome.i18n.getMessage("sel_XcptsSelType_4")}if(this.strXcptsUsesRegExp===null){this.strXcptsUsesRegExp=" ("+chrome.i18n.getMessage("sel_XcptsUsesRegExp")+")"}}},gSvdMsg:{timerID:null,bAnimOn:false},gnAdvSldrFreqGrad_DataColFreq:10,gnAdvSldrFreqGradBtn_DataColFreq:100,gnAdvSldrFreqGrad_PersistSaveFreq:1000,gnAdvSldrFreqGradBtn_PersistSaveFreq:1000,localizeHtmlPage:function(){var c=document.getElementsByTagName("html");for(var a=0;a<c.length;a++){var d=c[a];var e=d.innerHTML.toString();var b=e.replace(/__MSG_(\w+)__/g,function(g,h){var f=h?chrome.i18n.getMessage(h):"";return f?f:(h?h:"")});if(b!=e){d.innerHTML=b}}},makeNonDraggable:function(){$("a").each(function(a){var b=$(this);b.attr("draggable",false)});$("img").each(function(a){var b=$(this);b.attr("draggable",false)})},logExceptionReport:function(c,a){var b=chrome.extension.getBackgroundPage();b.gl.logExceptionReport(c,a)},logReport:function(a){var b=chrome.extension.getBackgroundPage();b.gl.logReport(a)},logWarning:function(a){var b=chrome.extension.getBackgroundPage();b.gl.logWarning(a)},logError:function(a){var b=chrome.extension.getBackgroundPage();b.gl.logError(a)},overrideConsole:function(){if(!gl._fnConsoleLog){gl._fnConsoleLog=console.log;console.log=function(){gl._fnConsoleLog.apply(console,arguments);if(arguments.length>0){gl.logReport(arguments[0])}}}if(!gl._fnConsoleWarn){gl._fnConsoleWarn=console.warn;console.warn=function(){gl._fnConsoleWarn.apply(console,arguments);if(arguments.length>0){gl.logWarning(arguments[0])}}}if(!gl._fnConsoleErr){gl._fnConsoleErr=console.error;console.error=function(){gl._fnConsoleErr.apply(console,arguments);if(arguments.length>0){gl.logError(arguments[0])}}}},_fnConsoleLog:null,_fnConsoleWarn:null,_fnConsoleErr:null,encodeHtml:function(a){var b=chrome.extension.getBackgroundPage();return b.gl.encodeHtml(a)},abbrevString:function(c,a){var b=chrome.extension.getBackgroundPage();return b.gl.abbrevString(c,a)},isInt:function(a){var b=chrome.extension.getBackgroundPage();return b.gl.isInt(a)},isRegExpValid:function(a){var b=chrome.extension.getBackgroundPage();return b.gl.isRegExpValid(a)},getSettingsRef:function(){var a=chrome.extension.getBackgroundPage();return a.gl.gSettings},getDefaultSettingsRef:function(){var a=chrome.extension.getBackgroundPage();return a.gl.gSettings_Default},getStorageRef:function(){var a=chrome.extension.getBackgroundPage();return a.gl.oStorage},getMinMaxSettingsVals:function(){var a=chrome.extension.getBackgroundPage();return a.gl.getMinMaxSettingsVals()},clipboardCopyText:function(d,b){try{var a=false;if(!d){d=""}if(b!==false){d=this.replaceNewLines(d)}document.oncopy=function(f){try{f.clipboardData.setData("Text",d.toString());f.preventDefault();a=true}catch(g){gl.logExceptionReport(311,g)}};document.execCommand("Copy",false,null);document.oncopy=undefined;return a}catch(c){gl.logExceptionReport(215,c);return false}},replaceNewLines:function(b){var a=chrome.extension.getBackgroundPage();return a.gl.replaceNewLines(b)},setStorageObject:function(a){var b=chrome.extension.getBackgroundPage();return b.gl.setStorageObject(a,true)},setSettingsObject:function(a,b){var c=chrome.extension.getBackgroundPage();return c.gl.setSettingsObject(a,b)},clearAllPersistentStorage:function(b,a){var c=chrome.extension.getBackgroundPage();c.gl.clearAllPersistentStorage(b,a)},showGeneralSettings:function(){var a=chrome.extension.getBackgroundPage();a.gl.openGeneralSettingsWindow()},getThisAppName:function(){var a=chrome.extension.getBackgroundPage();return a.gl.gstrAppName},getThisAppVersion:function(){var a=chrome.extension.getBackgroundPage();return a.gl.getThisAppVersion()},getCurrentTimeUTC:function(){var a=chrome.extension.getBackgroundPage();return a.gl.getCurrentTimeUTC()},getSettingsExport:function(a,d,b,c){var e=chrome.extension.getBackgroundPage();e.gl.getSettingsExport(a,d,b,c)},compareVersions:function(c,b){var a=chrome.extension.getBackgroundPage();return a.gl.compareVersions(c,b)},convertFromUTCTicks:function(a){return a-new Date().getTimezoneOffset()*60000},formatDateTimeFromTicks:function(a){return new Date(a).toLocaleString()},checkUrlExceptions:function(a){var b=chrome.extension.getBackgroundPage();return b.gl.checkUrlExceptions(a)},getLastVisitedURL:function(){var a=chrome.extension.getBackgroundPage();return a.gl.getLastVisitedURL()},openURL:function(a){var b=chrome.extension.getBackgroundPage();return b.gl.openURL(a)},getMaxPersistStorageSize:function(a){var b=chrome.extension.getBackgroundPage();return b.gl.getMaxPersistStorageSize(a)},getCurrentPersistStorageUsage:function(b,a){var c=chrome.extension.getBackgroundPage();c.gl.getCurrentPersistStorageUsage(b,a)},showModalPrompt_OKCancel:function(d,b,g,f,h,c){var a=false;try{$("#dialog-confirm-msgtxt").html(d.replace(/\n/g,"<br />"));$("#dialog-confirm").dialog({resizable:false,height:"auto",modal:true,title:b,buttons:[{text:g,click:function(){$(this).dialog("close");if(h){h(c)}}},{text:f,click:function(){$(this).dialog("close")}}]});a=true}catch(i){gl.logExceptionReport(117,i);a=false}return a},enableDisableCtrls:function(f,b){var a="#cccccc";for(var c=0;c<f.length;c++){var e=document.getElementById(f[c]);if(e){if(e.nodeName=="INPUT"){var d=e.type?e.type.toLowerCase():"";if(d=="checkbox"){e.disabled=!b;var g=e.parentElement;if(g&&g.nodeName=="LABEL"){g.style.color=b?"":a}}}else{if(e.nodeName=="SELECT"||e.nodeName=="LEGEND"){e.disabled=!b;e.style.color=b?"":a}}}}},onCheckForUpdates:function(a){if(!a.bUpdateAvail){console.log("[181] Checking for updates");var c=$("#"+a.id);c.fadeOut({duration:200,complete:function(){chrome.runtime.requestUpdateCheck(function(d,f){console.log("[182] Update check result: "+d+", v="+f.version);d=d?d.toString().toLowerCase():"";var e;switch(d){case"no_update":a.bUpdateAvail=false;c.attr("style","color: #bababa !important");e=chrome.i18n.getMessage("msg_no_update");break;case"update_available":a.bUpdateAvail=true;c.attr("style","color: #01ca2b !important");e=chrome.i18n.getMessage("msg_yes_update").replace("#V#",f.version?f.version:"?");break;default:a.bUpdateAvail=false;c.attr("style","color: #ca0101 !important");e=chrome.i18n.getMessage("msg_err_update");break}c.text(e);c.attr("title",gl.encodeHtml(e));c.fadeIn()})}})}else{console.log("[183] Manually reloading to install update");var b=chrome.extension.getBackgroundPage();b.gl.onInstallUpdate()}},saveSettings:function(a,b){try{var d=chrome.extension.getBackgroundPage();d.gl.onPersistentSaveSettings(function(e){if(e===true){if(a!=-1){gl.setSavedResultTxt(a!==undefined&&a!==null?a:1)}if(b){b(true)}}else{if(a!=-1){gl.setSavedResultTxt(0)}console.error("[202] Failed to save settings: "+e);if(b){b(e)}}})}catch(c){gl.logExceptionReport(203,c);if(b){b("[288] Err")}}},saveFailed:function(){gl.setSavedResultTxt(0)},setSavedResultTxt:function(a){if(gl.gSvdMsg.bAnimOn){window.setTimeout(function(){gl.setSavedResultTxt(a)},1);return}var b=$("#divSavd>span");b.show();if(a==1){b.text(gl.gSngltnPrmpts.strSavedOK);b.attr("class","svdOK")}else{if(a==2){b.text(gl.gSngltnPrmpts.strRemovedOK);b.attr("class","svdOK")}else{if(a==3){b.text(gl.gSngltnPrmpts.strImportedOK);b.attr("class","svdOK")}else{b.text(gl.gSngltnPrmpts.strSavedErr);b.attr("class","svdErr")}}}if(gl.gSvdMsg.timerID){window.clearTimeout(gl.gSvdMsg.timerID);gl.gSvdMsg.timerID=null}gl.gSvdMsg.timerID=window.setTimeout(function(){gl.gSvdMsg.timerID=null;gl.gSvdMsg.bAnimOn=true;b.fadeOut({duration:200,complete:function(){b.text("");b.removeAttr("class");gl.gSvdMsg.bAnimOn=false}})},3000)},onTabSelected:function(b,c){var a=gl.getTabDomIDByIndex(b);switch(a){case"#tabGeneral":gl.onTabSelected_General();break;case"#tabMemory":gl.onTabSelected_Memory(c);break;case"#tabStorage":gl.onTabSelected_Storage(c);break;case"#tabIncognito":gl.onTabSelected_Incognito();break;case"#tabExceptions":gl.onTabSelected_Exceptions();break;case"#tabAdvanced":gl.onTabSelected_Advanced();break;default:console.error("[179] No handler for tab `"+a+"`, index="+b);break}gl.gstrSelTabId=a},onTabSelected_General:function(){gl.updateTabCtrls_General()},onTabSelected_Memory:function(a){if(a){$("#idFsAdvMemOps").show()}else{$("#idFsAdvMemOps").hide()}gl.updateTabCtrls_Memory()},onTabSelected_Storage:function(a){gl.updateTabCtrls_Storage()},onTabSelected_Incognito:function(){$("#linkSettings").attr("href","#");$("#linkSettings").click(function(a){a.stopPropagation();a.preventDefault();gl.showGeneralSettings()});gl.updateTabCtrls_Incognito()},onTabSelected_Exceptions:function(){gl.updateTabCtrls_Exceptions()},onTabSelected_Advanced:function(){gl.updateTabCtrls_Advanced()},getTabIndexByDomID:function(b){var a=$('#tabs a[href="'+b+'"]').parent().index();return a},getTabDomIDByIndex:function(a){return $("#tabs ul>li>a").eq(a).attr("href")},updateTabCtrls:function(){switch(gl.gstrSelTabId){case"#tabGeneral":gl.updateTabCtrls_General();break;case"#tabMemory":gl.updateTabCtrls_Memory();break;case"#tabStorage":gl.updateTabCtrls_Storage();break;case"#tabIncognito":gl.updateTabCtrls_Incognito();break;case"#tabExceptions":gl.updateTabCtrls_Exceptions();break;case"#tabAdvanced":gl.updateTabCtrls_Advanced();break;default:console.error("[184] No handler for tab '"+gl.gstrSelTabId+"'");break}},updateTabCtrls_General:function(){var b=gl.getSettingsRef();var a=b.bCollectData?true:false;$("#chkCollectData").prop("checked",a);$("#chkSingleLine").prop("checked",!!(b.nCollectFlgs&4));$("#chkMultiLine").prop("checked",!!(b.nCollectFlgs&1));$("#chkFmtInput").prop("checked",!!(b.nCollectFlgs&2));$("#chkNumberTbxs").prop("checked",!!(b.nCollectFlgs&16));$("#chkSearchTbxs").prop("checked",!!(b.nCollectFlgs&32));$("#chkURLTbxs").prop("checked",!!(b.nCollectFlgs&128));$("#chkEmailTbxs").prop("checked",!!(b.nCollectFlgs&8));$("#chkTelTbxs").prop("checked",!!(b.nCollectFlgs&64));$("#chkColAutocmplt").prop("checked",!!(b.nCollectFlgs&131072));gl.enableGeneralTabCtrls(a)},enableGeneralTabCtrls:function(b){if(b!==true&&b!==false){b=$("#chkCollectData").is(":checked")?true:false}var a=["chkSingleLine","chkMultiLine","chkFmtInput","chkNumberTbxs","chkSearchTbxs","chkURLTbxs","chkEmailTbxs","chkTelTbxs","chkColAutocmplt"];gl.enableDisableCtrls(a,b)},updateTabCtrls_Memory:function(){var d=gl.getSettingsRef();var a=document.getElementById("idRangeMaxNumPgs");var f=document.getElementById("idRangeMaxNumTbxPerPg");var b=document.getElementById("idRangeMaxNumEntrysPerTbx");a.value=d.nMaxPageNum;f.value=d.nMaxTxBxNum;b.value=d.nMaxTxtValNum;$("#idSldrMaxNumPgs").text(d.nMaxPageNum.toString());$("#idSldrMaxNumTbxPerPg").text(d.nMaxTxBxNum.toString());$("#idSldrMaxNumEntrysPerTbx").text(d.nMaxTxtValNum.toString());var e=gl.getStorageRef();var c=Object.keys(e).length;$("#idFtrMemColWbPgs").text(chrome.i18n.getMessage("msg_idFtrMemColWbPgs")+" "+c.toString())},onApplyChanges_Memory:function(){if(gl.normalizeFormDataToStorage()){gl.saveSettings()}else{gl.saveFailed()}gl.updateTabCtrls_Memory()},updateTabCtrls_Storage:function(){var a=gl.getSettingsRef();$("#radStgTypeNone").prop("checked",a.nPersistStorageType==0);$("#radStgTypeLocalStorage").prop("checked",a.nPersistStorageType==1);$("#radStgTypeChromeLocal").prop("checked",a.nPersistStorageType==2);gl.updateStorageUsageBar(true)},onSliderPosChanged_MaxNumPgs:function(a){var b=parseInt(a.value,10);$("#idSldrMaxNumPgs").text(b.toString());var c=gl.getMinMaxSettingsVals();if(b>=c.nMaxPageNum.min&&b<=c.nMaxPageNum.max){gl.getSettingsRef().nMaxPageNum=b;gl.saveSettings()}else{gl.saveFailed()}},onButtonLess_MaxNumPgs:function(a){var b=document.getElementById("idRangeMaxNumPgs");var c=b.value;c--;if(c<b.min){c=b.min}b.value=c;gl.onSliderPosChanged_MaxNumPgs(b)},onButtonMore_MaxNumPgs:function(a){var b=document.getElementById("idRangeMaxNumPgs");var c=b.value;c++;if(c>b.max){c=b.max}b.value=c;gl.onSliderPosChanged_MaxNumPgs(b)},onSliderPosChanged_MaxNumTbxPerPg:function(a){var b=parseInt(a.value,10);$("#idSldrMaxNumTbxPerPg").text(b.toString());var c=gl.getMinMaxSettingsVals();if(b>=c.nMaxTxBxNum.min&&b<=c.nMaxTxBxNum.max){gl.getSettingsRef().nMaxTxBxNum=b;gl.saveSettings()}else{gl.saveFailed()}},onButtonLess_MaxNumTbxPerPg:function(a){var b=document.getElementById("idRangeMaxNumTbxPerPg");var c=b.value;c--;if(c<b.min){c=b.min}b.value=c;gl.onSliderPosChanged_MaxNumTbxPerPg(b)},onButtonMore_MaxNumTbxPerPg:function(a){var b=document.getElementById("idRangeMaxNumTbxPerPg");var c=b.value;c++;if(c>b.max){c=b.max}b.value=c;gl.onSliderPosChanged_MaxNumTbxPerPg(b)},onSliderPosChanged_MaxNumEntrysPerTbx:function(a){var b=parseInt(a.value,10);$("#idSldrMaxNumEntrysPerTbx").text(b.toString());var c=gl.getMinMaxSettingsVals();if(b>=c.nMaxTxtValNum.min&&b<=c.nMaxTxtValNum.max){gl.getSettingsRef().nMaxTxtValNum=b;gl.saveSettings()}else{gl.saveFailed()}},onButtonLess_MaxNumEntrysPerTbx:function(a){var b=document.getElementById("idRangeMaxNumEntrysPerTbx");var c=b.value;c--;if(c<b.min){c=b.min}b.value=c;gl.onSliderPosChanged_MaxNumEntrysPerTbx(b)},onButtonMore_MaxNumEntrysPerTbx:function(a){var b=document.getElementById("idRangeMaxNumEntrysPerTbx");var c=b.value;c++;if(c>b.max){c=b.max}b.value=c;gl.onSliderPosChanged_MaxNumEntrysPerTbx(b)},updateStorageUsageBar:function(c){var b=gl.getSettingsRef();if(b.nPersistStorageType!=0){var a=gl.getMaxPersistStorageSize(b.nPersistStorageType);gl.getCurrentPersistStorageUsage(b.nPersistStorageType,function(e){if(a>0&&e>=0){var d=e*100/a;gl.setStorageFillBar(d)}else{console.error("[212] Error in storage size data: nSz="+e+", nMaxSz="+a);gl.setStorageFillBar(null)}});if(c===true){$("#idLgndPersistStg").show()}}else{gl.setStorageFillBar(null);if(c===true){$("#idLgndPersistStg").hide()}}},setStorageFillBar:function(g){var b=(g===null||g===undefined);if(b){g=0}if(g<0){g=0}else{if(g>100){g=100}}var d=$("#idStrgUsgBar");var e=d.parent();var i=e.outerWidth();var f=e.outerHeight()-1;var c=i*g/100;var a=document.getElementById("idSmplCvs");a.width=i;a.height=f;var k=a.getContext("2d");k.clearRect(0,0,i,f);k.globalAlpha=0.5;var j=gl.getUsageBarColorForPerc(g);k.fillStyle=j;k.fillRect(0,0,c,f);d.text(!b?(g.toFixed(1)+"%"):"-")},getUsageBarColorForPerc:function(g){if(!gl._gArrUsgBarClrs){var e=document.getElementById("idSmplCvs");var d=$("#idUsgBarSrc");var h=d.width();var a=e.getContext("2d");a.drawImage(d[0],0,0);var b=a.getImageData(0,0,h,1);gl._gArrUsgBarClrs=[];for(var f=0;f<b.data.length;f+=4){gl._gArrUsgBarClrs.push("rgb("+b.data[f]+","+b.data[f+1]+","+b.data[f+2]+")")}}if(g<0){g=0}else{if(g>100){g=100}}var j=gl._gArrUsgBarClrs.length;var c=g*j/100;return gl._gArrUsgBarClrs[~~c]},_gArrUsgBarClrs:null,updateTabCtrls_Incognito:function(){var a=gl.getSettingsRef();chrome.extension.isAllowedIncognitoAccess(function(b){if(b){$("#idIncogWarn").hide()}else{$("#idIncogWarn").show()}$("#chkCollectFromIncog").prop("checked",a.bIncogCollectData);$("#chkSaveIncogData").prop("checked",a.bIncogSavePersistStorage);$("#idViewMxd").val(a.nViewIncogData.toString());gl.updateAfterViewMxdChange(a.nViewIncogData);var c=["chkCollectFromIncog","chkSaveIncogData","idLgndViewMxd","idViewMxd","idRstDefs_Incog"];gl.enableDisableCtrls(c,b?true:false);$("#idRstDefs_Incog").click(function(d){d.stopPropagation();d.preventDefault();if(b){gl.resetToDefaults_Incognito()}})})},updateTabCtrls_Exceptions:function(){gl.xcptsLoadList()},xcptsLoadList:function(b){var a=gl.getSettingsRef();$("#chkXcptsHdrAll").prop("checked",false);gl.createExceptionsTbl(b);gl.xcptUpdateLnkCtrls()},createExceptionsTbl:function(b){var f="";var g=gl.getSettingsRef().arrExcepts;var l=[];for(var e=0;e<g.length;e++){l.push({ind:e,mt:g[e].mt,rx:g[e].rx,tp:g[e].tp})}l.sort(function(m,i){if(m.mt>i.mt){return 1}else{if(m.mt<i.mt){return -1}else{return 0}}});var j=null;if(l.length>0){if(!gl.isInt(b)){j=gl.xcptGetSelRow()}else{j=b}if(j===null){var k=gl.getLastVisitedURL();if(k){j=gl.checkUrlExceptions(k)}}var d=gl.encodeHtml(chrome.i18n.getMessage("xcptsSelType"));for(var a=0;a<l.length;a++){var c=l[a];var h=c.ind;f+='<tr class="trXcptLn" xcptid="'+h+'"><td><input xcptid="'+h+'" class="chkXcptLn" type="checkbox" value="1"></td>';f+='<td><a href="#" class="lnkXcptLn">'+gl.encodeHtml(gl.getExceptStrForType(c))+"</a>";f+="<span>"+gl.encodeHtml(c.mt)+"</span></td></tr>"}}else{f+='<tr><td colspan="2" class="noEntrsXcpts">'+gl.encodeHtml(chrome.i18n.getMessage("xcptsNoExcepts"))+"</td></tr>"}document.getElementById("idBdyTblXcpts").innerHTML=f;$(".trXcptLn").click(function(m){var i=$(this);var n=i.attr("xcptid");gl.xcptSelectRow(n,true,true)});$(".chkXcptLn").change(function(i){gl.xcptUpdateLnkCtrls()});$(".lnkXcptLn").click(function(i){i.stopPropagation();i.preventDefault();var m=$(this).parent().parent().attr("xcptid");if(m){gl.xcptEditException(m)}});if(j!==null){gl.xcptSelectRow(j,true,false)}},xcptUpdateRow:function(a){var c=false;var b=gl.getSettingsRef().arrExcepts;if(a>=0&&a<b.length){$(".trXcptLn").each(function(g){var e=$(this);if(a==e.attr("xcptid")){var h=e.children("td:eq(1)");var f=h.find("a");var j=h.find("span");if(f.length==1&&j.length==1){c=true;var d=b[a];f.text(gl.getExceptStrForType(d));j.text(d.mt)}return false}})}return c},xcptSelectRow:function(c,a,b){$(".trXcptLn").each(function(e){var l=$(this);if(l.attr("xcptid")!=c){l.removeClass("trXcptLnHilite")}else{l.addClass("trXcptLnHilite");if(a){var m=$("#idDivXcpts");var j=l.offset();var k=m.offset();var d=m[0].clientHeight;var g=l.outerHeight(true);var h=null;if(j.top<k.top){h=j.top-k.top}else{if(j.top+g>k.top+d){h=j.top+g-(k.top+d)}}if(h){var f=m.scrollTop();if(b===true){m.animate({scrollTop:h+f},100)}else{m.scrollTop(h+f)}}}}})},xcptGetSelRow:function(){var a=$(".trXcptLnHilite");if(a.length>0){var b=a.attr("xcptid");if(gl.isInt(b)){return parseInt(b,10)}}return null},xcptGetCheckedRows:function(){var b=[];var a=gl.getSettingsRef().arrExcepts;$(".chkXcptLn").each(function(e){var c=$(this);if(c.prop("checked")){var d=parseInt(c.attr("xcptid"),10);if(gl.isInt(d)&&d>=0&&d<a.length){b.push({ind:d,mt:a[d].mt,rx:a[d].rx,tp:a[d].tp})}}});return b},xcptUpdateLnkCtrls:function(){var d=gl.xcptGetCheckedRows().length;var c=gl.getSettingsRef().arrExcepts.length;var f=chrome.extension.getBackgroundPage();var a=f.gl.gnMaxExcepts;var b=gl.getLastVisitedURL();gl.enableLink($("#idLnkXcptsEdit"),d==1);gl.enableLink($("#idLnkXcptsRemove"),d>0);gl.enableLink($("#idLnkXcptsAddNew"),c<a);var e=$("#idLnkXcptsAddCurrent");gl.enableLink(e,c<a&&b);if(b){e.attr("title",b)}else{e.removeAttr("title")}},enableLink:function(b,a){if(a){b.removeAttr("style")}else{b.attr("style","pointer-events: none; cursor: default; color: #999 !important;")}},onXcptAddNew:function(){gl.xcptAddException()},onXcptAddLastVisited:function(){gl.xcptAddException(gl.getLastVisitedURL())},onXcptEdit:function(){var a=gl.xcptGetCheckedRows();if(a.length==1){gl.xcptEditException(a[0].ind)}else{console.error("[265] Wrong number of checkboxes="+a.length)}},onXcptRemove:function(){var a=gl.xcptGetCheckedRows();if(a.length>0){gl.showModalPrompt_OKCancel(chrome.i18n.getMessage("msg_remove_xcpts").replace("#N#",a.length),chrome.i18n.getMessage("msg_title_remove"),chrome.i18n.getMessage("btn_remove"),chrome.i18n.getMessage("btn_cancel"),function(){var d=gl.getSettingsRef().arrExcepts;for(var c=0;c<a.length;c++){var b=a[c].ind;if(b<0||b>=d.length||d[b].mt!=a[c].mt||d[b].rx!=a[c].rx||d[b].tp!=a[c].tp){console.warn("[276] Can't remove exception - it was changed since it was checked in the list: nInd="+b+", arrLn="+d.length+", tp0="+a[c].tp+", tp1="+(b>=0&&b<d.length?d[b].tp:"-")+", rx0="+a[c].rx+", rx1="+(b>=0&&b<d.length?d[b].rx:"-")+", mt0="+a[c].mt+", mt1="+(b>=0&&b<d.length?d[b].mt:"-"));a.splice(c,1);c--}}a.sort(function(f,e){return e.ind-f.ind});for(var c=0;c<a.length;c++){var b=a[c].ind;d.splice(b,1)}gl.saveSettings();gl.xcptsLoadList()})}else{console.error("[275] Wrong number of checkboxes="+a.length)}},xcptAddException:function(c){var d=gl.getSettingsRef().arrExcepts.length;var e=chrome.extension.getBackgroundPage();var b=e.gl.gnMaxExcepts;if(d<b){if(c){var a=c.match(/^(?:http|https)\:\/\/(?:www\.)?([^\/?#:]+)/i);if(a&&a.length>1){c=a[1]}else{console.warn("[274] Last visited URL did not suit for the exception: "+c);c=""}}gl.xcptShowEditWnd(null,c,gl._onXcptAddEditException,function(j){if(Object.prototype.toString.call(j)==="[object Object]"){var h=j.url;var g=j.rx;var f=parseInt(j.tp,10);h=h?h.toString().trim().toLowerCase():"";var i=gl.getSettingsRef().arrExcepts;var k=gl.getMinMaxSettingsVals();if(h&&gl.isInt(f)&&f>=k.arrExcepts.tp.min&&f<=k.arrExcepts.tp.max){if(g!==true||(g===true&&gl.isRegExpValid(h))){i.push({mt:h,rx:g,tp:f});gl.saveSettings();gl.xcptsLoadList(i.length-1)}else{console.error("[324] Bad exception regexp='"+h+"'")}}else{console.error("[272] Bad exception data: url='"+h+"', tp="+f+", ind="+nInd+", arrLn="+i.length)}}else{if(j!==false){console.error("[271] Add exception failed: "+j)}}})}else{gl.logError("[270] Can't add another exception, count="+d)}},xcptEditException:function(a){gl.xcptShowEditWnd(a,null,gl._onXcptAddEditException,function(h){if(Object.prototype.toString.call(h)==="[object Object]"){var e=h.url;var d=h.rx;var b=parseInt(h.tp,10);var c=parseInt(h.ind,10);e=e?e.toString().trim().toLowerCase():"";var g=gl.getSettingsRef().arrExcepts;var i=gl.getMinMaxSettingsVals();if(e&&gl.isInt(b)&&b>=i.arrExcepts.tp.min&&b<=i.arrExcepts.tp.max&&gl.isInt(c)&&c>=0&&c<g.length){if(d!==true||(d===true&&gl.isRegExpValid(e))){var f=g[c];f.mt=e;f.rx=d;f.tp=b;gl.saveSettings();if(!gl.xcptUpdateRow(c)){gl.logError("[269] Row update failed, ind="+c)}}else{console.error("[323] Bad exception regexp='"+e+"'")}}else{console.error("[268] Bad exception data: url='"+e+"', tp="+b+", ind="+c+", arrLn="+g.length)}}else{if(h!==false){console.error("[266] Exception edit failed: "+h)}}})},_onXcptAddEditException:function(a,e,g,f){var d=null;var c=gl.getSettingsRef().arrExcepts;a=a?a.trim().toLowerCase():"";if(a){if(e!==true||(e===true&&gl.isRegExpValid(a))){d=true;for(var b=0;b<c.length;b++){if(f!=b&&c[b].mt==a&&c[b].tp==g){d=chrome.i18n.getMessage("err_xcpts_msg02");gl.xcptSelectRow(b,true,true);break}}}else{d=chrome.i18n.getMessage("err_xcpts_msg04")}}else{d=chrome.i18n.getMessage("err_xcpts_msg01")}return d},xcptShowEditWnd:function(n,d,b,a){try{var l=n!==null;n=parseInt(n,10);var c=gl.getSettingsRef().arrExcepts;var o=1;var j=false;var m=null;var h=null;var g=null;if(l){if(n>=0&&n<c.length){d=c[n].mt;j=c[n].rx?true:false;o=c[n].tp;m=o;h=d;g=j}else{console.error("[273] Bad index to edit="+n+", arrLn="+c.length);l=false}}var i=gl.encodeHtml(d);var f=null;$("#dialog-xcpts-msgbdy").html("<fieldset><legend>"+gl.encodeHtml(chrome.i18n.getMessage("msg_lgndXcpts_Params"))+'</legend><div><input id="idXcptsSelUrl" type="text"'+(d?' value="'+i+'"':"")+'><a class="hdrLink" href="#" title="'+gl.encodeHtml(chrome.i18n.getMessage("prompt_OpenPage"))+'" target="_blank"></a><span id="idXcptsMsg_dialog-confirm"></span></div><label class="smChkBx"><input id="chkUrlRegExp" type="checkbox" value="1">'+gl.encodeHtml(chrome.i18n.getMessage("xcptsUseRegExp"))+"</label><div><span>"+gl.encodeHtml(chrome.i18n.getMessage("xcptsSelType"))+'</span><select id="idXcptsSelType"><option value="0"'+(o==0?" selected":"")+">"+gl.encodeHtml(chrome.i18n.getMessage("sel_XcptsSelType_0"))+'</option><option value="1"'+(o==1?" selected":"")+">"+gl.encodeHtml(chrome.i18n.getMessage("sel_XcptsSelType_1"))+'</option><option value="2"'+(o==2?" selected":"")+">"+gl.encodeHtml(chrome.i18n.getMessage("sel_XcptsSelType_2"))+'</option><option value="3"'+(o==3?" selected":"")+">"+gl.encodeHtml(chrome.i18n.getMessage("sel_XcptsSelType_3"))+'</option><option value="4"'+(o==4?" selected":"")+">"+gl.encodeHtml(chrome.i18n.getMessage("sel_XcptsSelType_4"))+'</option></select><span id="idDescXcptsSelType" class="cmbDesc"></span><span class="cmbDesc">'+gl.encodeHtml(chrome.i18n.getMessage("msg_example"))+'</span><span class="cmbDesc indt1">'+gl.encodeHtml(chrome.i18n.getMessage("msg_lgndXcpts_msg01"))+'<span class="xcptDescExmp01" id="idXcptDescExmp"></span></span><span class="cmbDesc indt1" id="idXcptDescMtchs"></span></div></fieldset>');$("#dialog-xcpts").dialog({resizable:false,height:"auto",minWidth:560,modal:true,title:chrome.i18n.getMessage(l?"msg_XcptEdit_title":"msg_XcptAdd_title"),open:function(e,p){$("#idXcptsMsg_dialog-confirm").hide();gl.xcptUpdateXcptTypeDesc(parseInt($("#idXcptsSelType").val(),10));$("#chkUrlRegExp").prop("checked",j?true:false);$(".hdrLink").click(function(q){q.stopPropagation();q.preventDefault();if(!$("#chkUrlRegExp").prop("checked")){var r=$("#idXcptsSelUrl").val();gl.openURL(r)}});$("#idXcptsSelType").change(function(r){var q=parseInt($(this).val(),10);gl.xcptUpdateXcptTypeDesc(q)});$("#idXcptsSelUrl").keypress(function(q){if(q.keyCode==$.ui.keyCode.ENTER){$("#idXcptBtnOkAdd").trigger("click")}})},buttons:[{text:chrome.i18n.getMessage(l?"btn_ok":"btn_add"),id:"idXcptBtnOkAdd",click:function(){var t=$("#idXcptsSelUrl").val();var e=$("#chkUrlRegExp").prop("checked")?true:false;var s=parseInt($("#idXcptsSelType").val(),10);var p=null;var r=null;if(l){if(n>=0&&n<c.length&&c[n].tp==m&&c[n].mt==h&&c[n].rx==g){r=n}else{p=chrome.i18n.getMessage("err_xcpts_msg03")}}if(!p){p=b?b(t,e,s,r):true}if(p===true){$(this).dialog("close");if(a){a({ind:r,url:t?t:"",rx:e,tp:s})}}else{if(f){window.clearTimeout(f);f=null}var q=p?p.toString():"";if(!q){q="[267] "+chrome.i18n.getMessage("msg_err_general")}$("#idXcptsMsg_dialog-confirm").show();$("#idXcptsMsg_dialog-confirm").text(q);f=window.setTimeout(function(){f=null;$("#idXcptsMsg_dialog-confirm").hide();$("#idXcptsMsg_dialog-confirm").text("")},8000)}}},{text:chrome.i18n.getMessage("lnk_close"),click:function(){$(this).dialog("close");if(a){a(false)}}}]})}catch(k){gl.logExceptionReport(259,k);if(a){a(null)}}},xcptUpdateXcptTypeDesc:function(a){var c=gl.xcptGetXcptTypeDesc(a);$("#idDescXcptsSelType").text(c.dsc);$("#idXcptDescExmp").text(c.exmpl);var d=gl.encodeHtml(chrome.i18n.getMessage("msg_lgndXcpts_msg02"));for(var b=0;b<c.urls.length;b++){d+='<span class="xcptDescExmp01 nln">'+c.urls[b]+"</span>"}$("#idXcptDescMtchs").html(d)},xcptGetXcptTypeDesc:function(a){var d="";var c=[];var b="";switch(a){case 0:d=chrome.i18n.getMessage("desc_XcptsSelType_0");b="http://slides.example.com/php/page.php";c.push("<em>http://slides.example.com/php/page.php</em>");break;case 1:d=chrome.i18n.getMessage("desc_XcptsSelType_1");b="slides.example.com";c.push("https://www.<em>slides.example.com</em>");c.push("http://<em>slides.example.com</em>/php/page.php?what=doc#print");c.push("http://www.<em>slides.example.com</em>:80/php/page.php?what=doc#print");break;case 2:d=chrome.i18n.getMessage("desc_XcptsSelType_2");b="www.slides.example.com";c.push("https://<em>www.slides.example.com</em>");c.push("http://<em>www.slides.example.com</em>/php/page.php?what=doc#print");c.push("http://<em>www.slides.example.com</em>:80/php/page.php?what=doc#print");break;case 3:d=chrome.i18n.getMessage("desc_XcptsSelType_3");b="slides.example.com/php/page.php";c.push("https://www.<em>slides.example.com/php/page.php</em>");c.push("http://<em>slides.example.com/php/page.php</em>?what=doc#print");c.push("http://www.<em>slides.example.com</em>:80<em>/php/page.php</em>?what=doc#print");break;case 4:d=chrome.i18n.getMessage("desc_XcptsSelType_4");b="www.slides.example.com/php/page.php";c.push("https://<em>www.slides.example.com/php/page.php</em>");c.push("http://<em>www.slides.example.com/php/page.php</em>?what=doc#print");c.push("http://<em>www.slides.example.com</em>:80<em>/php/page.php</em>?what=doc#print");break}return{dsc:d,exmpl:b,urls:c}},getExceptStrForType:function(a){var b="";switch(a.tp){case 0:b=gl.gSngltnPrmpts.strXcptsSelType_0;break;case 1:b=gl.gSngltnPrmpts.strXcptsSelType_1;break;case 2:b=gl.gSngltnPrmpts.strXcptsSelType_2;break;case 3:b=gl.gSngltnPrmpts.strXcptsSelType_3;break;case 4:b=gl.gSngltnPrmpts.strXcptsSelType_4;break}if(b&&a.rx===true){b+=gl.gSngltnPrmpts.strXcptsUsesRegExp}return b},onLinkClicked_ExportAllSettings:function(){try{gl.getSettingsExport("sttgsObjExport",0,false,function(b){if(b===null){b="/*# ErrorCollecting #*/"}$("#dialog-impexp-msgbdy").html("<span>"+gl.encodeHtml(chrome.i18n.getMessage("msg_expSttgsMsg_message"))+'</span><textarea readonly id="idTxtArea_dialog-confirm" class="exportTbx"></textarea>');$("#dialog-impexp").dialog({resizable:false,height:"auto",modal:true,title:chrome.i18n.getMessage("msg_expSttgsMsg_title"),open:function(c,d){$("#idTxtArea_dialog-confirm").val(b)},buttons:[{text:chrome.i18n.getMessage("lnk_copy"),click:function(){gl.clipboardCopyText(b,true);$(this).dialog("close")}},{text:chrome.i18n.getMessage("lnk_close"),click:function(){$(this).dialog("close")}}]})})}catch(a){gl.logExceptionReport(277,a)}},onLinkClicked_ImportAllSettings:function(){try{$("#dialog-impexp-msgbdy").html("<span>"+gl.encodeHtml(chrome.i18n.getMessage("msg_impSttgsMsg_message"))+'</span><textarea id="idTxtArea_dialog-confirm" class="exportTbx"></textarea><span id="idImpExpMsg_dialog-confirm"></span>');var b=null;$("#dialog-impexp").dialog({resizable:false,height:"auto",modal:true,title:chrome.i18n.getMessage("msg_impSttgsMsg_title"),open:function(c,d){$("#idTxtArea_dialog-confirm").val("")},buttons:[{text:chrome.i18n.getMessage("lnk_import"),click:function(){var c="";var e=$("#idTxtArea_dialog-confirm").val();if(e){var d=gl.parseSettingsImport(e);if(d.dta){$("#idImpExpMsg_dialog-confirm").text("");$(this).dialog("close");gl.showModalPrompt_OKCancel(chrome.i18n.getMessage("msg_impSttgsMsg_last_msg").replace("#V#",d.ver.trim()).replace("#D#",d.dtExp.trim()),chrome.i18n.getMessage("msg_impSttgsMsg_title"),chrome.i18n.getMessage("lnk_import"),chrome.i18n.getMessage("lnk_close"),function(h){var f=gl.getSettingsRef();var g=$.extend(true,{},f);gl.setSettingsObject(h.dta,true);f=h.dta;gl.saveSettings(-1,function(i){var j=chrome.extension.getBackgroundPage();if(!!f.bCollectData!=!!g.bCollectData){j.gl.enableDataCollection(f.bCollectData)}gl.resetMainDataCollectionTimer(1);gl.resetMainPersistDataSaveTimer(1);j.gl.changePersistentStorageType(f.nPersistStorageType,function(k){if(k===true&&i===true){gl.setSavedResultTxt(3);gl.logReport("[280] Imported settings: verExported="+h.ver+", dateExported="+h.dtExp)}else{gl.saveFailed();gl.logError("[280] Error importing settings: verExported="+h.ver+", dateExported="+h.dtExp+", resSv="+i+", resStg="+k)}gl.updateTabCtrls_Advanced()})})},d)}else{c=d.err;if(!c){c="[279] "+chrome.i18n.getMessage("msg_impMsg_err02")}}}else{c=chrome.i18n.getMessage("msg_impSttgsMsg_err01")}if(c){if(b){window.clearTimeout(b);b=null}$("#idImpExpMsg_dialog-confirm").show();$("#idImpExpMsg_dialog-confirm").text(c);b=window.setTimeout(function(){b=null;$("#idImpExpMsg_dialog-confirm").hide();$("#idImpExpMsg_dialog-confirm").text("")},5000)}}},{text:chrome.i18n.getMessage("lnk_close"),click:function(){$(this).dialog("close")}}]})}catch(a){gl.logExceptionReport(278,a)}},parseSettingsImport:function(j){var i=null;var g="";var a="";var c="";try{if(j){j=j.toString().trim();var h=gl.parseStorageImportStamp(j,"sttgsObjExport");if(h.stp){var f=gl.compareVersions(gl.getThisAppVersion(),h.stp.ver);if(f===0||f===1){a=h.stp.ver;c=gl.formatDateTimeFromTicks(gl.convertFromUTCTicks(h.stp.dt));var b=chrome.extension.getBackgroundPage();i=b.gl.checkAndInstantiateObjSettings(h.jsn?JSON.parse(h.jsn):null);if(!i){g="[286] "+chrome.i18n.getMessage("msg_impMsg_err02")}}else{if(f==-1){g="[285] "+chrome.i18n.getMessage("msg_impMsg_err05").replace("#V#",h.stp.ver)}else{g="[284] "+chrome.i18n.getMessage("msg_impMsg_err04")+": "+h.stp.ver}}}else{g="[283] "+chrome.i18n.getMessage("msg_impMsg_err03")}}else{g="[282] "+chrome.i18n.getMessage("msg_impMsg_err03")}}catch(d){gl.logExceptionReport(287,d);i=null;g="[281] "+chrome.i18n.getMessage("msg_impMsg_err02")}return{dta:i,ver:a,dtExp:c,err:g}},updateTabCtrls_Advanced:function(){var c=gl.getSettingsRef();$("#idCopyTxtOpt").val(c.nCopySubstNewLines.toString());var b=document.getElementById("idRangeDataColFreq");var a=document.getElementById("idRangePersistSaveFreq");b.value=c.nCollectFormDataFreqMs;a.value=c.nSavePersistDataFreqMs;$("#idSldrDataColFreq").text(c.nCollectFormDataFreqMs.toString()+" "+chrome.i18n.getMessage("abbrv_ms"));gl.formatMinSecField("#idSldrPersistSaveFreq",c.nSavePersistDataFreqMs);$("#chkIdAndNm").prop("checked",!!(c.nCollectFlgs&65536));$("#chkUseNtvScrlBrs").prop("checked",c.bUseNativeScrollbars)},onSliderPosChanged_DataColFreq:function(a){var b=parseInt(a.value,10);$("#idSldrDataColFreq").text(b.toString()+" "+chrome.i18n.getMessage("abbrv_ms"));var c=gl.getMinMaxSettingsVals();if(b>=c.nCollectFormDataFreqMs.min&&b<=c.nCollectFormDataFreqMs.max){gl.getSettingsRef().nCollectFormDataFreqMs=b;gl.saveSettings();gl.resetMainDataCollectionTimer(1000)}else{gl.saveFailed()}},resetMainDataCollectionTimer:function(a){if(gl.__gnTimerUpdtMainPollTmr){window.clearTimeout(gl.__gnTimerUpdtMainPollTmr);gl.__gnTimerUpdtMainPollTmr=null}gl.__gnTimerUpdtMainPollTmr=window.setTimeout(function(){var b=chrome.extension.getBackgroundPage();b.gl.setTimer_FormDataCollection()},a?a:0)},__gnTimerUpdtMainPollTmr:null,onButtonLess_DataColFreq:function(a){var b=document.getElementById("idRangeDataColFreq");var c=parseInt(b.value,10);c-=gl.gnAdvSldrFreqGradBtn_DataColFreq;c/=gl.gnAdvSldrFreqGradBtn_DataColFreq;c=Math.round(c);c*=gl.gnAdvSldrFreqGradBtn_DataColFreq;if(c<b.min){c=b.min}b.value=c;gl.onSliderPosChanged_DataColFreq(b)},onButtonMore_DataColFreq:function(a){var b=document.getElementById("idRangeDataColFreq");var c=parseInt(b.value,10);c+=gl.gnAdvSldrFreqGradBtn_DataColFreq;c/=gl.gnAdvSldrFreqGradBtn_DataColFreq;c=Math.round(c);c*=gl.gnAdvSldrFreqGradBtn_DataColFreq;if(c>b.max){c=b.max}b.value=c;gl.onSliderPosChanged_DataColFreq(b)},formatMinSecField:function(d,e){var a=Math.round(e/1000);var g=a/60;g=~~g;var b=a%60;var c=true;var f="";if(g>0){f=g.toString()+" "+chrome.i18n.getMessage("abbrv_min");if(b){f+=" : "}else{c=false}}if(c){f+=b.toString()+" "+chrome.i18n.getMessage("abbrv_sec")}$(d).text(f)},onSliderPosChanged_PersistSaveFreq:function(a){var b=parseInt(a.value,10);gl.formatMinSecField("#idSldrPersistSaveFreq",b);var c=gl.getMinMaxSettingsVals();if(b>=c.nSavePersistDataFreqMs.min&&b<=c.nSavePersistDataFreqMs.max){gl.getSettingsRef().nSavePersistDataFreqMs=b;gl.saveSettings();gl.resetMainPersistDataSaveTimer(1000)}else{gl.saveFailed()}},resetMainPersistDataSaveTimer:function(a){if(gl.__gnTimerSavePrstsStg){window.clearTimeout(gl.__gnTimerSavePrstsStg);gl.__gnTimerSavePrstsStg=null}gl.__gnTimerSavePrstsStg=window.setTimeout(function(){var b=chrome.extension.getBackgroundPage();b.gl.setTimer_PersistDataSave()},a?a:0)},__gnTimerSavePrstsStg:null,onButtonLess_PersistSaveFreq:function(a){var b=document.getElementById("idRangePersistSaveFreq");var c=parseInt(b.value,10);c-=gl.gnAdvSldrFreqGradBtn_PersistSaveFreq;c/=gl.gnAdvSldrFreqGradBtn_PersistSaveFreq;c=Math.round(c);c*=gl.gnAdvSldrFreqGradBtn_PersistSaveFreq;if(c<b.min){c=b.min}b.value=c;gl.onSliderPosChanged_PersistSaveFreq(b)},onButtonMore_PersistSaveFreq:function(a){var b=document.getElementById("idRangePersistSaveFreq");var c=parseInt(b.value,10);c+=gl.gnAdvSldrFreqGradBtn_PersistSaveFreq;c/=gl.gnAdvSldrFreqGradBtn_PersistSaveFreq;c=Math.round(c);c*=gl.gnAdvSldrFreqGradBtn_PersistSaveFreq;if(c>b.max){c=b.max}b.value=c;gl.onSliderPosChanged_PersistSaveFreq(b)},updateAfterViewMxdChange:function(a){var b=true;var c;switch(a){case 0:c="desc_cmbDropDwn_v0";break;case 1:c="desc_cmbDropDwn_v1";break;case 2:c="desc_cmbDropDwn_v2";break;default:b=false;c=null;console.error("[201] Bad type="+a);break}$("#idDescViewMxd").text(c?chrome.i18n.getMessage(c):"");return b},onCheckboxChange_CollectFlgs:function(a,c,b){if(c){a.nCollectFlgs|=b}else{a.nCollectFlgs&=~b}gl.saveSettings()},onCheckboxChange:function(e){var b=e.id;var d=e.checked?true:false;var a=gl.getSettingsRef();switch(b){case"chkCollectData":gl.enableGeneralTabCtrls(d);var c=chrome.extension.getBackgroundPage();c.gl.enableDataCollection(d);gl.setSavedResultTxt(1);break;case"chkSingleLine":gl.onCheckboxChange_CollectFlgs(a,d,4);break;case"chkMultiLine":gl.onCheckboxChange_CollectFlgs(a,d,1);break;case"chkFmtInput":gl.onCheckboxChange_CollectFlgs(a,d,2);break;case"chkNumberTbxs":gl.onCheckboxChange_CollectFlgs(a,d,16);break;case"chkSearchTbxs":gl.onCheckboxChange_CollectFlgs(a,d,32);break;case"chkURLTbxs":gl.onCheckboxChange_CollectFlgs(a,d,128);break;case"chkEmailTbxs":gl.onCheckboxChange_CollectFlgs(a,d,8);break;case"chkTelTbxs":gl.onCheckboxChange_CollectFlgs(a,d,64);break;case"chkColAutocmplt":gl.onCheckboxChange_CollectFlgs(a,d,131072);break;case"chkCollectFromIncog":a.bIncogCollectData=d;gl.saveSettings();break;case"chkSaveIncogData":a.bIncogSavePersistStorage=d;gl.saveSettings();break;case"chkIdAndNm":if(d){a.nCollectFlgs|=65536}else{a.nCollectFlgs&=~65536}gl.saveSettings();break;case"chkUseNtvScrlBrs":a.bUseNativeScrollbars=d;gl.saveSettings();break;case"chkXcptsHdrAll":$(".chkXcptLn").each(function(){this.checked=d});gl.xcptUpdateLnkCtrls();break;default:console.error("[206] Unsupported id="+b);break}},onRadioboxChange:function(b){var a=b.id;var c=b.checked?true:false;if(c){switch(a){case"radStgTypeNone":gl.onChangePersistentStorageType(0);break;case"radStgTypeLocalStorage":gl.onChangePersistentStorageType(1);break;case"radStgTypeChromeLocal":gl.onChangePersistentStorageType(2);break;default:console.error("[230] Unsupported id="+a);break}}else{console.error("[229] Unsupported radio box state, id="+a+", checked="+c)}},onLinkClicked:function(b,a){a.stopPropagation();a.preventDefault();var c=b.id;switch(c){case"idLnkExportAll":gl.onLinkClicked_ExportAllData();break;case"idLnkImportAll":gl.onLinkClicked_ImportAllData();break;case"idLnkClearAll":gl.onRemoveAll();break;case"idLnkClearIncog":gl.onRemoveAll_Incognito();break;case"idLnkApplyChngs":gl.onApplyChanges_Memory();break;case"idLnkXcptsEdit":gl.onXcptEdit();break;case"idLnkXcptsRemove":gl.onXcptRemove();break;case"idLnkXcptsAddNew":gl.onXcptAddNew();break;case"idLnkXcptsAddCurrent":gl.onXcptAddLastVisited();break;case"idLnkExportSttgsAll":gl.onLinkClicked_ExportAllSettings();break;case"idLnkImportSttgsAll":gl.onLinkClicked_ImportAllSettings();break;default:console.error("[213] Unprocessed link clicked, id="+c);break}},onChangePersistentStorageType:function(a,b){var c=chrome.extension.getBackgroundPage();c.gl.changePersistentStorageType(a,function(d){if(d===true){gl.setSavedResultTxt(1)}else{gl.logError("[238] Error changing stg type: "+d);gl.saveFailed()}gl.updateStorageUsageBar(true);if(b){b(d)}})},onRemoveAll:function(){gl.showModalPrompt_OKCancel(chrome.i18n.getMessage("msg_removeAll_message"),chrome.i18n.getMessage("msg_removeAll_title"),chrome.i18n.getMessage("btn_remove"),chrome.i18n.getMessage("btn_cancel"),function(){var c=gl.getStorageRef();var b=Object.keys(c).length;var a={};gl.setStorageObject(a);gl.clearAllPersistentStorage(null,function(d){if(d===true){gl.setSavedResultTxt(2);gl.logReport("[226] Removed all "+b+" record(s) of storage data")}else{gl.logError("[237] Error removing all records: "+d);gl.saveFailed()}gl.updateStorageUsageBar()})})},onRemoveAll_Incognito:function(){gl.showModalPrompt_OKCancel(chrome.i18n.getMessage("msg_removeAll_Incog_message"),chrome.i18n.getMessage("msg_removeAll_title"),chrome.i18n.getMessage("btn_remove"),chrome.i18n.getMessage("btn_cancel"),function(){var d=gl.getStorageRef();var a=[];for(var c in d){if(d[c].flg&2){a.push(c)}}for(var b=0;b<a.length;b++){delete d[a[b]]}gl.setStorageObject(d);gl.updateStorageUsageBar();gl.setSavedResultTxt(2);gl.logReport("[227] Removed "+a.length+" incognito record(s) from storage data")})},onLinkClicked_ExportAllData:function(){try{var c=gl.getStorageRef();var a="";$("#dialog-impexp-msgbdy").html("<span>"+gl.encodeHtml(chrome.i18n.getMessage("msg_expMsg_message"))+'</span><img id="idSpnr_dialog-confirm" draggable="false" src="images/spnr.gif" class="spnrExport" /><textarea readonly id="idTxtArea_dialog-confirm" class="taExport exportTbx"></textarea>');$("#dialog-impexp").dialog({resizable:false,height:"auto",modal:true,title:chrome.i18n.getMessage("msg_expMsg_title"),open:function(d,e){$("#idTxtArea_dialog-confirm").val("")},buttons:[{text:chrome.i18n.getMessage("lnk_copy"),click:function(){if(a){gl.clipboardCopyText(a,true);$(this).dialog("close")}}},{text:chrome.i18n.getMessage("lnk_close"),click:function(){$(this).dialog("close")}}]});window.setTimeout(function(){a=JSON.stringify(c);$("#idSpnr_dialog-confirm").hide();$("#idTxtArea_dialog-confirm").show();var d='/*##[ %nm%="'+gl.getThisAppName()+'"; %tp%="dataObjExport"; %ver%="'+gl.getThisAppVersion()+'"; %dt%="'+gl.getCurrentTimeUTC()+'"; ]##*/\n';a=d+a;$("#idTxtArea_dialog-confirm").val(a)},200)}catch(b){gl.logExceptionReport(214,b)}},onLinkClicked_ImportAllData:function(){try{$("#dialog-impexp-msgbdy").html("<span>"+gl.encodeHtml(chrome.i18n.getMessage("msg_impMsg_message"))+'</span><textarea id="idTxtArea_dialog-confirm" class="exportTbx"></textarea><span id="idImgMsg_dialog-confirm"></span>');var b=null;$("#dialog-impexp").dialog({resizable:false,height:"auto",modal:true,title:chrome.i18n.getMessage("msg_impMsg_title"),open:function(c,d){$("#idTxtArea_dialog-confirm").val("")},buttons:[{text:chrome.i18n.getMessage("lnk_import"),click:function(){var c="";var e=$("#idTxtArea_dialog-confirm").val();if(e){var d=gl.parseStorageImport(e);if(d.dta){$("#idImgMsg_dialog-confirm").text("");$(this).dialog("close");gl.showModalPrompt_OKCancel(chrome.i18n.getMessage("msg_impMsg_last_msg").replace("#V#",d.ver.trim()).replace("#D#",d.dtExp.trim()).replace("#P#",Object.keys(d.dta).length),chrome.i18n.getMessage("msg_impMsg_title"),chrome.i18n.getMessage("lnk_import"),chrome.i18n.getMessage("lnk_close"),function(f){gl.setStorageObject(f.dta);gl.setSavedResultTxt(3);gl.updateTabCtrls_Memory();gl.logReport("[225] Imported storage data: verExported="+f.ver+", dateExported="+f.dtExp+", pages="+Object.keys(f.dta).length)},d)}else{c=d.err;if(!c){c="[223] "+chrome.i18n.getMessage("msg_impMsg_err02")}}}else{c=chrome.i18n.getMessage("msg_impMsg_err01")}if(c){if(b){window.clearTimeout(b);b=null}$("#idImgMsg_dialog-confirm").show();$("#idImgMsg_dialog-confirm").text(c);b=window.setTimeout(function(){b=null;$("#idImgMsg_dialog-confirm").hide();$("#idImgMsg_dialog-confirm").text("")},5000)}}},{text:chrome.i18n.getMessage("lnk_close"),click:function(){$(this).dialog("close")}}]})}catch(a){gl.logExceptionReport(216,a)}},parseStorageImport:function(j){var i=null;var g="";var a="";var c="";try{if(j){j=j.toString().trim();var h=gl.parseStorageImportStamp(j,"dataObjExport");if(h.stp){var f=gl.compareVersions(gl.getThisAppVersion(),h.stp.ver);if(f===0||f===1){a=h.stp.ver;c=gl.formatDateTimeFromTicks(gl.convertFromUTCTicks(h.stp.dt));var b=chrome.extension.getBackgroundPage();i=b.gl.checkAndInstantiateObjStorage(h.jsn,true,true);if(!i){g="[224] "+chrome.i18n.getMessage("msg_impMsg_err02")}}else{if(f==-1){g="[220] "+chrome.i18n.getMessage("msg_impMsg_err05").replace("#V#",h.stp.ver)}else{g="[219] "+chrome.i18n.getMessage("msg_impMsg_err04")+": "+h.stp.ver}}}else{g="[218] "+chrome.i18n.getMessage("msg_impMsg_err03")}}else{g="[217] "+chrome.i18n.getMessage("msg_impMsg_err03")}}catch(d){gl.logExceptionReport(221,d);i=null;g="[222] "+chrome.i18n.getMessage("msg_impMsg_err02")}return{dta:i,ver:a,dtExp:c,err:g}},parseStorageImportStamp:function(l,g){var f=null;var h="";if(l){if(l.indexOf("/*##[")===0){var j=l.indexOf("]##*/");if(j>0){var e=l.substr(5,j-5);if(e){f={};var k=e.split(";");for(var d=0;d<k.length;d++){var c=k[d].trim();if(c){var b=c.split("=");if(b.length==2){var m=b[0].trim();var a=b[1].trim();if(m&&a){if(m[0]=="%"&&m.length>2&&m[m.length-1]=="%"){m=m.substr(1,m.length-2);if(a[0]=='"'&&a.length>=2&&a[a.length-1]=='"'){a=a.substr(1,a.length-2)}f[m]=a}else{return null}}else{return null}}else{return null}}}j+=5;h=l.substr(j,l.length-j).trim()}}}}if(f){if(f.nm!=gl.getThisAppName()||f.tp!=g||!f.ver||!f.dt||!gl.isInt(f.dt)){f=null}}return{stp:f,jsn:h}},resetToDefaults_General:function(){gl.showModalPrompt_OKCancel(chrome.i18n.getMessage("msg_reset_defaults"),chrome.i18n.getMessage("msg_title_reset_defaults"),chrome.i18n.getMessage("btn_reset"),chrome.i18n.getMessage("btn_cancel"),function(){var a=gl.getDefaultSettingsRef();var b=gl.getSettingsRef();b.nCollectFlgs=a.nCollectFlgs;if(!!b.bCollectData!=!!a.bCollectData){var c=chrome.extension.getBackgroundPage();c.gl.enableDataCollection(a.bCollectData)}gl.updateTabCtrls_General();gl.saveSettings()})},resetToDefaults_Memory:function(){gl.showModalPrompt_OKCancel(chrome.i18n.getMessage("msg_reset_defaults"),chrome.i18n.getMessage("msg_title_reset_defaults"),chrome.i18n.getMessage("btn_reset"),chrome.i18n.getMessage("btn_cancel"),function(){var a=gl.getDefaultSettingsRef();var b=gl.getSettingsRef();b.nMaxPageNum=a.nMaxPageNum;b.nMaxTxBxNum=a.nMaxTxBxNum;b.nMaxTxtValNum=a.nMaxTxtValNum;gl.updateTabCtrls_Memory();gl.saveSettings()})},resetToDefaults_Storage:function(){gl.showModalPrompt_OKCancel(chrome.i18n.getMessage("msg_reset_defaults"),chrome.i18n.getMessage("msg_title_reset_defaults"),chrome.i18n.getMessage("btn_reset"),chrome.i18n.getMessage("btn_cancel"),function(){var a=gl.getDefaultSettingsRef();gl.onChangePersistentStorageType(a.nPersistStorageType,function(b){gl.updateTabCtrls_Storage()})})},resetToDefaults_Incognito:function(){gl.showModalPrompt_OKCancel(chrome.i18n.getMessage("msg_reset_defaults"),chrome.i18n.getMessage("msg_title_reset_defaults"),chrome.i18n.getMessage("btn_reset"),chrome.i18n.getMessage("btn_cancel"),function(){var a=gl.getDefaultSettingsRef();var b=gl.getSettingsRef();b.bIncogCollectData=a.bIncogCollectData;b.bIncogSavePersistStorage=a.bIncogSavePersistStorage;b.nViewIncogData=a.nViewIncogData;gl.updateTabCtrls_Incognito();gl.saveSettings()})},resetToDefaults_Exceptions:function(){gl.showModalPrompt_OKCancel(chrome.i18n.getMessage("msg_reset_defaults"),chrome.i18n.getMessage("msg_title_reset_defaults"),chrome.i18n.getMessage("btn_reset"),chrome.i18n.getMessage("btn_cancel"),function(){var a=gl.getDefaultSettingsRef();var b=gl.getSettingsRef();b.arrExcepts=a.arrExcepts;gl.updateTabCtrls_Exceptions();gl.saveSettings()})},resetToDefaults_Advanced:function(){gl.showModalPrompt_OKCancel(chrome.i18n.getMessage("msg_reset_defaults"),chrome.i18n.getMessage("msg_title_reset_defaults"),chrome.i18n.getMessage("btn_reset"),chrome.i18n.getMessage("btn_cancel"),function(){var b=gl.getDefaultSettingsRef();var c=gl.getSettingsRef();c.nCollectFormDataFreqMs=b.nCollectFormDataFreqMs;c.nSavePersistDataFreqMs=b.nSavePersistDataFreqMs;c.bUseNativeScrollbars=b.bUseNativeScrollbars;var a=c.nCollectFlgs&~65536;a|=b.nCollectFlgs&65536;c.nCollectFlgs=a;c.nCopySubstNewLines=b.nCopySubstNewLines;gl.resetMainDataCollectionTimer(1);gl.resetMainPersistDataSaveTimer(1);gl.updateTabCtrls_Advanced();gl.saveSettings()})},normalizeFormDataToStorage:function(){var a=chrome.extension.getBackgroundPage();return a.gl.normalizeFormDataToStorage()},getUrlParams:function(a){var b=chrome.extension.getBackgroundPage();return b.gl.getUrlParams(a)},onMessageProc:function(c,b,a){if(c.action=="update03"){gl.updateTabCtrls()}else{if(a){a(null)}}},onInitPage:function(){$("#idVer").text(chrome.i18n.getMessage("version_num").replace("#V#",gl.getThisAppVersion()));var b=new Date();var j=b.getFullYear();var i=2014;$("#idCprght").text(chrome.i18n.getMessage("copyright_msg").replace("#Y#",j>i?i.toString()+" - "+j.toString():i.toString()));var h=$("#idOpenSrc");h.html(chrome.i18n.getMessage("openSource").replace("#U#","https://github.com/dennisbabkin/Formalizr"));var f=$("#idDev");f.text("www.dennisbabkin.com");f.attr("href","http://www.dennisbabkin.com/software");f.attr("target","_blank");$("#idCheckUpdts").click(function(l){l.stopPropagation();l.preventDefault();gl.onCheckForUpdates(l.target)});$(":checkbox").change(function(l){gl.onCheckboxChange(this)});$(":radio").change(function(l){gl.onRadioboxChange(this)});$(".lnkInline").click(function(l){gl.onLinkClicked(this,l)});$(".lnkBlock").click(function(l){gl.onLinkClicked(this,l)});$("#idLnkApplyChngs").click(function(l){gl.onLinkClicked(this,l)});$("#idRstDefs_General").click(function(l){l.stopPropagation();l.preventDefault();gl.resetToDefaults_General()});$("#idRstDefs_Storage").click(function(l){l.stopPropagation();l.preventDefault();gl.resetToDefaults_Storage()});var a=document.getElementById("idRangeMaxNumPgs");var g=document.getElementById("idRangeMaxNumTbxPerPg");var k=document.getElementById("idRangeMaxNumEntrysPerTbx");var e=gl.getMinMaxSettingsVals();a.min=e.nMaxPageNum.min;a.max=e.nMaxPageNum.max;g.min=e.nMaxTxBxNum.min;g.max=e.nMaxTxBxNum.max;k.min=e.nMaxTxtValNum.min;k.max=e.nMaxTxtValNum.max;a.addEventListener("change",function(l){gl.onSliderPosChanged_MaxNumPgs(l.target)});g.addEventListener("change",function(l){gl.onSliderPosChanged_MaxNumTbxPerPg(l.target)});k.addEventListener("change",function(l){gl.onSliderPosChanged_MaxNumEntrysPerTbx(l.target)});document.getElementById("idBtnLessMaxNumPgs").addEventListener("click",function(l){gl.onButtonLess_MaxNumPgs(l.target)});document.getElementById("idBtnMoreMaxNumPgs").addEventListener("click",function(l){gl.onButtonMore_MaxNumPgs(l.target)});document.getElementById("idBtnLessMaxNumTbxPerPg").addEventListener("click",function(l){gl.onButtonLess_MaxNumTbxPerPg(l.target)});document.getElementById("idBtnMoreMaxNumTbxPerPg").addEventListener("click",function(l){gl.onButtonMore_MaxNumTbxPerPg(l.target)});document.getElementById("idBtnLessMaxNumEntrysPerTbx").addEventListener("click",function(l){gl.onButtonLess_MaxNumEntrysPerTbx(l.target)});document.getElementById("idBtnMoreMaxNumEntrysPerTbx").addEventListener("click",function(l){gl.onButtonMore_MaxNumEntrysPerTbx(l.target)});$("#tabs ul>li a").eq(gl.getTabIndexByDomID("#tabMemory")).click(function(l){if(l.shiftKey){$("#idFsAdvMemOps").show()}});$("#idRstDefs_Memory").click(function(l){l.stopPropagation();l.preventDefault();gl.resetToDefaults_Memory()});$("#idViewMxd").change(function(m){var l=$(this).val();l=parseInt(l,10);if(gl.updateAfterViewMxdChange(l)){gl.getSettingsRef().nViewIncogData=l;gl.saveSettings()}else{gl.saveFailed()}});$("#idRstDefs_Xcpts").click(function(l){l.stopPropagation();l.preventDefault();gl.resetToDefaults_Exceptions()});$("#idCopyTxtOpt").change(function(m){var l=$(this).val();l=parseInt(l,10);var n=gl.getMinMaxSettingsVals();if(l>=n.nCopySubstNewLines.min&&l<=n.nCopySubstNewLines.max){gl.getSettingsRef().nCopySubstNewLines=l;gl.saveSettings()}else{gl.saveFailed()}});var d=document.getElementById("idRangeDataColFreq");var c=document.getElementById("idRangePersistSaveFreq");d.step=gl.gnAdvSldrFreqGrad_DataColFreq;d.min=e.nCollectFormDataFreqMs.min;d.max=e.nCollectFormDataFreqMs.max;c.step=gl.gnAdvSldrFreqGrad_PersistSaveFreq;c.min=e.nSavePersistDataFreqMs.min;c.max=e.nSavePersistDataFreqMs.max;d.addEventListener("change",function(l){gl.onSliderPosChanged_DataColFreq(l.target)});c.addEventListener("change",function(l){gl.onSliderPosChanged_PersistSaveFreq(l.target)});document.getElementById("idBtnLessDataColFreq").addEventListener("click",function(l){gl.onButtonLess_DataColFreq(l.target)});document.getElementById("idBtnMoreDataColFreq").addEventListener("click",function(l){gl.onButtonMore_DataColFreq(l.target)});document.getElementById("idBtnLessPersistSaveFreq").addEventListener("click",function(l){gl.onButtonLess_PersistSaveFreq(l.target)});document.getElementById("idBtnMorePersistSaveFreq").addEventListener("click",function(l){gl.onButtonMore_PersistSaveFreq(l.target)});$("#idRstDefs_Adv").click(function(l){l.stopPropagation();l.preventDefault();gl.resetToDefaults_Advanced()})}};gl.overrideConsole();$("body").hide();gl.localizeHtmlPage();gl.makeNonDraggable();gl.gSngltnPrmpts.loadSingletons();$(function(){chrome.tabs.query({active:true,currentWindow:true},function(c){gl.gnThisTabID=c[0].id;var b=gl.getUrlParams(document.URL);var a=0;if(b.p){var d=gl.getTabIndexByDomID("#"+b.p);if(d!=-1){a=d}}var e=$("#tabs");e.tabs({active:a,activate:function(f,g){gl.onTabSelected(g.newTab.index(),f.shiftKey?true:false)}});gl.onInitPage();$("body").show();gl.onTabSelected(a,false);chrome.tabs.onActivated.addListener(function(f){if(f.tabId==gl.gnThisTabID){gl.updateTabCtrls()}});chrome.windows.onFocusChanged.addListener(function(f){(function(){chrome.windows.getCurrent({populate:false},function(g){if(f==g.id){gl.updateTabCtrls()}})}())});chrome.runtime.onMessage.addListener(gl.onMessageProc)})});