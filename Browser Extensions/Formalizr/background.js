/*
Formalizr v. 1.0.0.3
Copyright (C) 2014-2019 www.dennisbabkin.com. All Rights Reserved.

This is an Open Source project. It is minified for efficiency.
To download readable source code, go to:
 https://github.com/dennisbabkin/Formalizr
*/

gl={oTabsData:{},oBadge:{bEnabledCollect:null},oStorage:{},gbMod_oStorage:false,gSettings:{appVersion:"",bCollectData:true,bIncogCollectData:true,nCollectFlgs:131327,arrExcepts:[],nMaxPageNum:48,nMaxTxBxNum:32,nMaxTxtValNum:32,nCopySubstNewLines:0,nPersistStorageType:2,bIncogSavePersistStorage:false,nCollectFormDataFreqMs:5000,nSavePersistDataFreqMs:10000,nViewIncogData:2,bUseNativeScrollbars:false},gSettings_Default:null,gstrAppName:"Formalizr",gstrPersistStorageKeyName:"stg",gstrPersistSettingsKeyName:"sttgs",gstrDevContact:"support@dennisbabkin.com",gnMaxExcepts:64,gstrLastVisitedTabURL:"",gPlatform:0,gOSInfo:{os:"",arc:""},gConsoleCache:[],gnMaxConsoleCacheLen:1024,processFormDataWithTopURL:function(s,f,a){var m=a?a:s.topURL;if(!m){return}var b=s.pageURL;var c=s.bIFrame;var r=s.ifrmI;var e=s.incg;if(!c){b=".";gl.gstrLastVisitedTabURL=m}else{b=r+">"+b}var h=this.gSettings.bCollectData;if(h&&!this.gSettings.bIncogCollectData&&s.incg){h=false}var j=false;if(gl.checkUrlExceptions(m)!==null){h=false;j=true}var p=null;var q={};var k=null;if(h){if(f in this.oTabsData){var n=this.oTabsData[f];if(!c||n.pageURL==m){n.pageURL=m;var g=n.pageData;if(!c&&s.pageTitle){g.ttl=s.pageTitle}if(!c&&s.favIconURL){g.fav=s.favIconURL}g.incg=s.incg;if(g.frms){if(b in g.frms){g.frms[b].dta=s.formData}else{g.frms[b]={dta:s.formData}}}else{var o={};o[b]={dta:s.formData};g.frms=o}}else{h=false}}else{var o={};o[b]={dta:s.formData};var l={ttl:!c?s.pageTitle:"",fav:!c?s.favIconURL:"",incg:s.incg,frms:o};this.oTabsData[f]={bdg:{},pageURL:m,injCntr:0,pageData:l}}p=this.oTabsData[f];var d=this.addFormDataToStorage(p,s.colRes===0);if(s.colRes!==1){d=s.colRes}k=true;var i=this.countTextboxesFound(p);p.bdg.nTxbBxCnt=i;q.strIconTextClr=i>=0&&d===1?"#414141":"#ff0000"}else{if(!(f in this.oTabsData)){this.oTabsData[f]={bdg:{},pageURL:m,injCntr:0,pageData:{}}}p=this.oTabsData[f];k=false;p.bdg.nTxbBxCnt=0;q.strIconTextClr="#414141"}p.bdg.bDataCollected=true;p.bdg.bExceptOn=j;p.bdg.bIncogTab=e;gl.getIcnData(p,q);gl.updateIconAndBadge(f,q)},processFormData:function(a,c){try{chrome.tabs.get(c,function(d){var g="";if(chrome.runtime.lastError){}else{try{g=d.url}catch(f){g=""}}gl.processFormDataWithTopURL(a,c,g)})}catch(b){}},gSngltnPrmpts:{strFormalizr:null,strDisabled:null,strExceptOn:null,strIncognito:null,loadSingletons:function(){if(this.strFormalizr===null){this.strFormalizr=chrome.i18n.getMessage("main_app_name")}if(this.strExceptOn===null){this.strExceptOn="("+chrome.i18n.getMessage("prompt_Exception")+")"}if(this.strDisabled===null){this.strDisabled="("+chrome.i18n.getMessage("prompt_Disabled")+")"}if(this.strIncognito===null){this.strIncognito=" - "+chrome.i18n.getMessage("msg_incognito")}}},addFormDataToStorage:function(k,j){var I=1;try{var x=gl.gSettings.nMaxPageNum;var l=gl.gSettings.nMaxTxBxNum;var w=gl.gSettings.nMaxTxtValNum;var v=k.pageURL;var z=this.getCurrentTimeUTC();if(v in this.oStorage){var y=0;var c=false;var E=this.oStorage[v];if(k.pageData.ttl){if(E.ttl!=k.pageData.ttl){E.ttl=k.pageData.ttl;c=true}}if(k.pageData.fav){if(E.fav!=k.pageData.fav){E.fav=k.pageData.fav;c=true}}if(j){E.flg|=1;I=0}for(var p in k.pageData.frms){var r=k.pageData.frms[p].dta;for(var u=0;u<r.length;u++){if(r[u].val){var G=this.getTbxID(r[u]);if(p in E.frms){if(G in E.frms[p]){var b=E.frms[p][G].tx;var h=b.length;if(h==0||b[h-1].v!=r[u].val){if(h==0||b[h-1].tm!=z){if(h>=w){b.splice(0,h-w+1)}b.push({tm:z,v:r[u].val})}else{b[h-1].v=r[u].val}E.tm=z;c=true}}else{var H=this._remExtraTxbxsFromPg(E,l-1,p);E.frms[p][G]={si:y+u,osi:r[u].si,id:r[u].id,nm:r[u].nm,tp:r[u].tp,tx:[{tm:z,v:r[u].val}]};E.tm=z;c=true;if(H>0){E.flg|=1;I=0}}}else{var m=this._remExtraTxbxsFromPg(E,l-1,null);var n={};n[G]={si:y+u,osi:r[u].si,id:r[u].id,nm:r[u].nm,tp:r[u].tp,tx:[{tm:z,v:r[u].val}]};E.frms[p]=n;E.tm=z;c=true;if(m>0){E.flg|=1;I=0}}}}y+=65536}if(c){var f=k.pageData.incg?2:0;if((E.flg&2)!=f){if(k.pageData.incg){E.flg|=2}else{E.flg&=~2}}gl.gbMod_oStorage=true}}else{var y=0;var B=0;var s=j;var o={};for(var p in k.pageData.frms){var n={};var r=k.pageData.frms[p].dta;for(var u=0;u<r.length;u++){if(r[u].val){if(B+Object.keys(n).length>l){s=true;break}n[this.getTbxID(r[u])]={si:y+u,osi:r[u].si,id:r[u].id,nm:r[u].nm,tp:r[u].tp,tx:[{tm:z,v:r[u].val}]}}}var A=Object.keys(n).length;if(A>0){o[p]=n;B+=A}y+=65536}if(Object.keys(o).length!=0){var g=Object.keys(this.oStorage).length;if(g>=x){var a=[];for(var C in this.oStorage){a.push({pgUrl:C,tm:this.oStorage[C].tm})}a.sort(function(i,e){return e.tm-i.tm});for(var D=a.length-1;D>=x-1;D--){delete this.oStorage[a[D].pgUrl]}}var d=s?1:0;if(k.pageData.incg){d|=2}this.oStorage[v]={tm:z,flg:d,ttl:k.pageData.ttl,fav:k.pageData.fav,frms:o};gl.gbMod_oStorage=true;if(s){I=0}}}}catch(F){gl.logExceptionReport(112,F);I=-1}return I},checkUrlExceptions:function(a){try{var l=gl.gSettings.arrExcepts;if(a&&l){var c,j,h,f,d;a=a.toLowerCase();for(var g=0;g<l.length;g++){var n=l[g].mt;var b=l[g].rx===true?new RegExp(n,"i"):null;switch(l[g].tp){case 0:if(!b?n==a:b.test(a)){return g}break;case 1:if(j===undefined){c=a.match(/^.*\:\/\/(?:www\.)?([^\/?#:]+)/);if(c&&c.length>1){j=c[1]}}if(!b?n==j:b.test(j)){return g}break;case 2:if(h===undefined){c=a.match(/^.*\:\/\/([^\/?#:]+)/);if(c&&c.length>1){h=c[1]}}if(!b?n==h:b.test(h)){return g}break;case 3:if(f===undefined){c=a.match(/^.*\:\/\/(?:www\.)?([^\/:]+)(?:[^:]*:\d+)?([^?#]+)/);if(c&&c.length>2){f=c[1].toString()+c[2].toString()}}if(!b?n==f:b.test(f)){return g}break;case 4:if(d===undefined){c=a.match(/^.*\:\/\/([^\/:]+)(?:[^:]*:\d+)?([^?#]+)/);if(c&&c.length>2){d=c[1].toString()+c[2].toString()}}if(!b?n==d:b.test(d)){return g}break}}}}catch(k){gl.logExceptionReport(320,k)}return null},normalizeFormDataToStorage:function(){var l=true;try{var o=gl.gSettings.nMaxPageNum;var a=gl.gSettings.nMaxTxBxNum;var p=gl.gSettings.nMaxTxtValNum;var h=Object.keys(this.oStorage).length;if(h>o){var n=[];for(var b in this.oStorage){n.push({pgUrl:b,tm:this.oStorage[b].tm})}n.sort(function(i,e){return e.tm-i.tm});for(var d=n.length-1;d>=o;d--){delete this.oStorage[n[d].pgUrl];gl.gbMod_oStorage=true}}for(pageURL in this.oStorage){var g=this.oStorage[pageURL];var c=this._remExtraTxbxsFromPg(g,a,null);if(c>0){gl.gbMod_oStorage=true;g.flg|=1}for(frmURL in g.frms){var m=g.frms[frmURL];for(tbxID in m){var k=m[tbxID].tx;var f=k.length;if(f>p){k.splice(0,f-p);gl.gbMod_oStorage=true}}}}}catch(j){gl.logExceptionReport(244,j);l=false}return l},_remExtraTxbxsFromPg:function(g,l,n){var e=0;var c=[];for(var f in g.frms){var m=g.frms[f];for(var a in m){var b=m[a].tx;var k=b.length>0?b[0].tm:0;for(var j=1;j<b.length;j++){if(b[j].tm>k){k=b[j].tm}}c.push({tm:k,fu:f,tid:a})}}if(c.length>l){c.sort(function(o,d){return d.tm-o.tm});var h;for(var i=c.length-1;i>=l;i--){h=c[i].fu;delete g.frms[h][c[i].tid];e++;if(Object.keys(g.frms[h]).length===0){if(!n||n!=h){delete g.frms[h]}}}}return e},getTbxID:function(a){return(a.id?a.id.toString().replace(/ /g,"-"):"_")+(a.nm?a.nm.toString().replace(/ /g,"-"):"_")+a.si.toString()},countTextboxesFound:function(a){var d=0;try{var b=a.pageData.frms;for(var c in b){d+=b[c].dta.length}}catch(f){d=-1}return d},enableDataCollection:function(a){gl.gSettings.bCollectData=a?true:false;gl.onPersistentSaveSettings(function(b){if(b!==true){console.error("[240] Failed to save settings: "+b)}gl.updateIconAndBadge_AllTabs();gl.closeAllPopupWindows();gl.updateOptionsPage()})},updateIconAndBadge_Default:function(a){a=true;if(gl.oBadge.bEnabledCollect!==a){(function(){gl.oBadge.bEnabledCollect=a;var b={};if(a){b={"19":"images/icon_off19.png","38":"images/icon_off38.png"}}else{b={"19":"images/icon_off_no19.png","38":"images/icon_off_no38.png"}}chrome.browserAction.setIcon({path:b},function(){if(chrome.runtime.lastError){console.log("[170] SetDefaultIcon failed, Desc: "+chrome.runtime.lastError.message)}else{chrome.browserAction.setTitle({title:gl.gSngltnPrmpts.strFormalizr+(a?"":" "+gl.gSngltnPrmpts.strDisabled)})}})}())}},getRef_oTabsDataForTab:function(b){if(b===null||b===undefined){return null}var a=gl.oTabsData[b];if(!a){a=gl.oTabsData[b]={bdg:{},pageURL:"",injCntr:0,pageData:{}}}return a},isTabDataCollected:function(b){var a=gl.oTabsData[b];if(a){return a.bdg.bDataCollected?true:false}return null},closeAllPopupWindows:function(a){try{chrome.windows.getLastFocused({populate:false},function(c){var d=c?c.id:0;chrome.windows.getAll({populate:false},function(j){for(var e=0;e<j.length;e++){var h=j[e].id;if(a||h!=d){var f=0;arrHtmlWnds=chrome.extension.getViews({windowId:h,type:"popup"});if(arrHtmlWnds){for(var g=0;g<arrHtmlWnds.length;g++){arrHtmlWnds[g].close()}}}}})})}catch(b){gl.logExceptionReport(178,b)}},updateActiveTabIconAndBadge:function(){try{chrome.tabs.query({active:true,currentWindow:true},function(b){if(chrome.runtime.lastError){}else{gl.updateIconAndBadge_Tab(b[0].id)}})}catch(a){gl.logExceptionReport(155,a)}},updateIconAndBadge_AllTabs:function(){try{chrome.windows.getAll({populate:true},function(c){for(var b=0;b<c.length;b++){var e=c[b].tabs;for(var d=0;d<e.length;d++){gl.updateIconAndBadge_Tab(e[d].id)}}})}catch(a){gl.logExceptionReport(177,a)}},updateIconAndBadge_Tab:function(c){var a=gl.getRef_oTabsDataForTab(c);if(a){var b={};gl.getIcnData(a,b);gl.updateIconAndBadge(c,b)}else{console.error("[176] ERR: Tab data missing, tabID="+c)}},getIcnData:function(a,e){var g=a.bdg.bIncogTab;var d=a.bdg.bExceptOn;var c=gl.gSettings.bCollectData;var b=c;if(c&&!gl.gSettings.bIncogCollectData&&g){c=false;b=false}if(c){if(d){c=false}}if(c){e.nIconType=!g?1:2;var f=a.bdg.nTxbBxCnt;if(f!==undefined){e.strIconText=f>0?f.toString():(f===0?"":"?")}e.strPromptText=gl.gSngltnPrmpts.strFormalizr+(g?gl.gSngltnPrmpts.strIncognito:"")}else{if(!b||!d){e.nIconType=!g?9:10}else{e.nIconType=!g?17:18}e.strIconText="";e.strPromptText=gl.gSngltnPrmpts.strFormalizr+(g?gl.gSngltnPrmpts.strIncognito:"")+" "+(!d?gl.gSngltnPrmpts.strDisabled:gl.gSngltnPrmpts.strExceptOn)}return e},updateIconAndBadge:function(d,b){var a=gl.oTabsData[d];if(a&&b){var c;if(a.bdg.bDataCollected){c=b.nIconType}else{if(b.nIconType!==undefined){c=b.nIconType>=16?16:(b.nIconType>=8?8:0)}else{if(a.bdg.nIconType!==undefined){c=a.bdg.nIconType>=16?16:(a.bdg.nIconType>=8?8:0)}else{c=0}}}if((c!==undefined&&c!==a.bdg.nIconType)||(b.strIconText!==undefined&&b.strIconText!==a.bdg.strIconText)||(b.strIconTextClr!==undefined&&b.strIconTextClr!==a.bdg.strIconTextClr)||(b.strPromptText!==undefined&&b.strPromptText!==a.bdg.strPromptText)){(function(){if(c!==undefined){a.bdg.nIconType=c}if(b.strIconText!==undefined){a.bdg.strIconText=b.strIconText}if(b.strIconTextClr!==undefined){a.bdg.strIconTextClr=b.strIconTextClr}if(b.strPromptText!==undefined){a.bdg.strPromptText=b.strPromptText}var f={};var e=a.bdg.nIconType;switch(e){case 1:f={"19":"images/icon19.png","38":"images/icon38.png"};break;case 2:f={"19":"images/icon_incog19.png","38":"images/icon_incog38.png"};break;case 8:f={"19":"images/icon_off_no19.png","38":"images/icon_off_no38.png"};break;case 9:f={"19":"images/icon_no19.png","38":"images/icon_no38.png"};break;case 10:f={"19":"images/icon_incog_no19.png","38":"images/icon_incog_no38.png"};break;case 16:f={"19":"images/icon_off_xcpt19.png","38":"images/icon_off_xcpt38.png"};break;case 17:f={"19":"images/icon_xcpt19.png","38":"images/icon_xcpt38.png"};break;case 18:f={"19":"images/icon_incog_xcpt19.png","38":"images/icon_incog_xcpt38.png"};break;default:f={"19":"images/icon_off19.png","38":"images/icon_off38.png"};if(e!==0){console.error("[173] Bad icon type="+e)}break}chrome.browserAction.setIcon({path:f,tabId:d},function(){if(chrome.runtime.lastError){a.bdg.nIconType=null;a.bdg.strIconText=null;a.bdg.strIconTextClr=null;a.bdg.strPromptText=null}else{if(b.strIconText!==undefined){chrome.browserAction.setBadgeText({text:b.strIconText,tabId:d})}if(b.strIconTextClr!==undefined){chrome.browserAction.setBadgeBackgroundColor({color:b.strIconTextClr,tabId:d})}if(b.strPromptText!==undefined){chrome.browserAction.setTitle({title:b.strPromptText,tabId:d})}}})}())}}else{console.error("[171] ERR: Tab data missing, tabID="+d+", iconData="+b)}},logReport:function(a){if(a){console.log(a)}},logWarning:function(a){if(a){console.warn(a)}},logError:function(a){if(a){console.error(a)}},logExceptionReport:function(c,b){var a="ERROR["+c+"]: ";if(b.stack){a+=b.stack}else{a+=b.message}console.error(a)},overrideGlobConsole:function(){if(!gl._fnConsoleLog){gl._fnConsoleLog=console.log;console.log=function(){gl._fnConsoleLog.apply(console,arguments);if(arguments.length>0){gl._logGlobConsole("",arguments[0])}}}if(!gl._fnConsoleWarn){gl._fnConsoleWarn=console.warn;console.warn=function(){gl._fnConsoleWarn.apply(console,arguments);if(arguments.length>0){gl._logGlobConsole("Warn",arguments[0])}}}if(!gl._fnConsoleErr){gl._fnConsoleErr=console.error;console.error=function(){gl._fnConsoleErr.apply(console,arguments);if(arguments.length>0){gl._logGlobConsole("ERR",arguments[0])}}}},_fnConsoleLog:null,_fnConsoleWarn:null,_fnConsoleErr:null,_logGlobConsole:function(c,a){try{if(gl.gConsoleCache.length+1>gl.gnMaxConsoleCacheLen){gl.gConsoleCache.splice(0,gl.gConsoleCache.length+1-gl.gnMaxConsoleCacheLen)}var b=new Date();gl.gConsoleCache.push(b.getFullYear()+"/"+(b.getMonth()+1).toString()+"/"+b.getDate()+" "+b.getHours()+":"+b.getMinutes()+":"+b.getSeconds()+"."+b.getMilliseconds()+"> "+(c?"["+c+"]: ":"")+a)}catch(d){}},getConsoleCacheAsStr:function(c){var b="";try{var f;for(var a=0;a<gl.gConsoleCache.length;a++){f=gl.gConsoleCache[a];if(c){f=gl._sanitizeUrlsInStr(f)}if(f){b+=f+"\n"}}}catch(d){gl.logExceptionReport(309,d);b=null}return b},updateInfoFromActiveTab:function(a){try{chrome.tabs.query({active:true,currentWindow:true},function(c){if(chrome.runtime.lastError){if(a){a(false)}}else{var g;var d=false;try{g=c[0].id;d=true}catch(f){}if(d){gl.updateInfoFromTab(g,a)}else{if(a){a(false)}}}})}catch(b){gl.logExceptionReport(104,b);if(a){a(false)}}},updateInfoFromTab:function(c,a){try{if(c!==null){(function(){var d=gl.getRef_oTabsDataForTab(c);d.bdg.bDataCollected=false;chrome.tabs.sendMessage(c,{action:"update02",retRes:a?true:false,sttgs:gl.getSettingsForContent()},function(e){if(!chrome.runtime.lastError&&e&&e.res===535){d.injCntr=0;gl._after_updateInfoFromTab(c,a,e)}else{window.setTimeout(function(f){if(f.injCntr<8){f.injCntr++;var g=chrome.runtime.getManifest();var h=g.content_scripts[0];chrome.tabs.executeScript(c,{file:h.js[0],allFrames:h.all_frames,matchAboutBlank:h.match_about_blank},function(i){if(chrome.runtime.lastError){if(a){a("[163] ERR: Inj. arrRes="+i+", err="+(chrome.runtime.lastError?chrome.runtime.lastError.message:"-"))}}else{chrome.tabs.sendMessage(c,{action:"update02",retRes:a?true:false,sttgs:gl.getSettingsForContent()},function(j){if(j&&j.res===535){f.injCntr=0;gl._after_updateInfoFromTab(c,a,j)}else{console.error("[164] INJ ERR: "+(chrome.runtime.lastError?chrome.runtime.lastError.message:"-"))}})}return})}else{if(a){a("[264] INJ ERR: Cntr="+f.injCntr)}}},100,d);return}return})})()}else{console.error("[160] Null tab");if(a){a("[161] ERR: Null")}}}catch(b){gl.logExceptionReport(107,b);gl.updateIconAndBadge_Tab(c);if(a){a("[162] ERR: "+b.message)}}},_after_updateInfoFromTab:function(c,b,a){if(a&&a.res===535){if(a.resData){gl.processFormData(a.resData,c);gl.updateIconAndBadge_Tab(c);if(b){b(true)}}else{gl.updateIconAndBadge_Tab(c);if(b){b(true)}}}else{gl.updateIconAndBadge_Tab(c);if(b){b(false)}}},fillAllFormData:function(a){try{chrome.tabs.query({active:true,currentWindow:true},function(d){if(chrome.runtime.lastError){console.log("[326] Error filling form data in content script")}else{var c=null;chrome.tabs.sendMessage(d[0].id,{action:"fill01",data:a},function(e){if(chrome.runtime.lastError||!e||e.res!==true){console.log("[121] Error filling form data in content script")}})}})}catch(b){gl.logExceptionReport(120,b)}},getMinMaxSettingsVals:function(){return{nMaxPageNum:{min:1,max:512},nMaxTxBxNum:{min:1,max:128},nMaxTxtValNum:{min:1,max:256},nCopySubstNewLines:{min:0,max:3},nPersistStorageType:{min:0,max:2},nCollectFormDataFreqMs:{min:1000,max:60000},nSavePersistDataFreqMs:{min:1000,max:600000},nViewIncogData:{min:0,max:2},arrExcepts:{tp:{min:0,max:4}}}},checkAndInstantiateObjSettings:function(c){var g=null;try{var j=Object.prototype.toString;if(c!==null&&typeof c==="object"){for(var d in gl.gSettings_Default){if(d in c){if(j.call(c[d])!==j.call(gl.gSettings_Default[d])){console.warn("[195] SttgsObj_ParseErr: Wrong type for '"+d+"'="+j.call(c[d]));return null}}else{console.warn("[194] SttgsObj_ParseWarn: Prop missing='"+d+"'");c[d]=gl.gSettings_Default[d]}}var a=gl.getMinMaxSettingsVals();for(var n in a){var l=a[n];if(l.min!==undefined&&l.max!==undefined){if(c[n]<l.min){console.warn("[198] SttgsObj_ParseWarn: Adjusted '"+n+"' from '"+c[n]+"' to '"+l.min+"'");c[n]=l.min}else{if(c[n]>l.max){console.warn("[199] SttgsObj_ParseWarn: Adjusted '"+n+"' from '"+c[n]+"' to '"+l.max+"'");c[n]=l.max}}}}var m=gl.compareVersions(c.appVersion,"1.0.0.2");if(isNaN(m)){console.warn("[321] SttgsObj_ParseErr: Bad version="+c.appVersion);return null}var k=c.arrExcepts;if(k&&j.call(k)==="[object Array]"){for(var f=0;f<k.length;f++){var h=k[f];if(m===-1){h.rx=false}if(!gl._checkAndInitProp_String(j,h,"mt",false)||!gl._checkAndInitProp_Int(j,h,"tp")||!gl._checkAndInitProp_Bool(j,h,"rx")){console.warn("[258] SttgsObj_ParseErr: For arrExcepts["+f+"]: mt='"+h.mt+"' ("+(h.mt?j.call(h.mt):"-")+"), rx='"+h.rx+"' ("+(h.rx?j.call(h.rx):"-")+"), tp='"+h.tp+"' ("+(h.tp?j.call(h.tp):"-")+")");return null}if(h.rx===true){if(!gl.isRegExpValid(h.mt)){console.warn("[322] SttgsObj_ParseErr: For arrExcepts["+f+"]: Bad RegExp="+h.mt);return null}}}}else{console.warn("[257] SttgsObj_ParseErr: Wrong type for 'arrExcepts'="+(k?j.call(k):"-"));return null}var k=c.arrExcepts;if(k){if(k.length>gl.gnMaxExcepts){k.splice(0,k.length-gl.gnMaxExcepts)}for(var b=0;b<k.length;b++){k[b].mt=k[b].mt.toString().toLowerCase()}}c.appVersion=gl.getThisAppVersion();g=c}else{console.warn("[193] SttgsObj_ParseErr");return null}}catch(f){console.warn("[191] SttgsObj_ParseErr: "+f.message);g=null}return g},setSettingsObject:function(a,b){gl.gSettings=a;if(b===true){gl.closeAllPopupWindows(true)}},setStorageObject:function(a,b){gl.oStorage=a;gl.gbMod_oStorage=false;if(b===true){gl.onPersistentSaveStorage(true);gl.closeAllPopupWindows(true)}},changePersistentStorageType:function(a,b){if(a>=0&&a<=2){(function(){gl.closeAllPopupWindows(true);gl.clearAllPersistentStorage(gl.gSettings.nPersistStorageType,function(c){if(c===true){gl.gSettings.nPersistStorageType=a;gl.onPersistentSaveSettings(function(d){if(d!==true){console.error("[239] Error saving settings: "+d)}gl.onPersistentSaveStorage(true,b)})}else{if(b){b("[236] Change failed: "+c)}}})}())}else{console.error("[231] Bad stg type="+a);if(b){b("[232] Bad type="+a)}}},clearAllPersistentStorage:function(b,a){if(b!=0&&b!=1&&b!=2){b=gl.gSettings.nPersistStorageType}if(b==0){if(a){a(true)}}else{if(b==1){localStorage.clear();if(a){a(true)}}else{if(b==2){chrome.storage.local.clear(function(){var c;if(chrome.runtime.lastError){c="[234] Clear error: "+chrome.runtime.lastError.message;console.error(c)}else{c=true}if(a){a(c)}})}else{console.error("[233] Bad type="+b)}}}},checkAndInstantiateObjStorage:function(j,i,f){var m=null;try{var q=i?JSON.parse(j):j;var p=Object.prototype.toString;if(q!==null&&typeof q==="object"&&(f===true||this._checkAndInitProp_String(p,q,"<ver>",false))){if(f!==true){var a=q["<ver>"];delete q["<ver>"]}for(var g in q){if(!g){console.log("[143] StgObj_ParseErr");return false}var d=q[g];if(d!==null&&typeof d==="object"&&this._checkAndInitProp_Int(p,d,"tm")&&this._checkAndInitProp_Int(p,d,"flg")&&this._checkAndInitProp_String(p,d,"ttl",true)&&this._checkAndInitProp_String(p,d,"fav",true)&&d.hasOwnProperty("frms")&&p.call(d.frms)==="[object Object]"){for(var b in d.frms){if(!b){console.log("[144] StgObj_ParseErr: pageUrl="+g);return null}var o=d.frms[b];if(o!==null&&typeof o==="object"){for(var n in o){if(!n){console.log("[145] StgObj_ParseErr: frmUrl="+b+", pageUrl="+g);return null}var c=o[n];if(c!==null&&typeof c==="object"&&this._checkAndInitProp_Int(p,c,"si")&&this._checkAndInitProp_Int(p,c,"osi")&&this._checkAndInitProp_String(p,c,"id",true)&&this._checkAndInitProp_String(p,c,"nm",true)&&this._checkAndInitProp_String(p,c,"tp",false)&&c.hasOwnProperty("tx")&&p.call(c.tx)==="[object Array]"){var l=o[n].tx;if(l.length>0){for(var r=0;r<l.length;r++){var h=l[r];if(h!==null&&typeof h==="object"&&this._checkAndInitProp_Int(p,h,"tm")&&this._checkAndInitProp_String(p,h,"v",false)){}else{console.log("[146] StgObj_ParseErr: t="+r+", tbxId="+n+", frmUrl="+b+", pageUrl="+g);return null}}}else{console.log("[147] StgObj_ParseErr: ln="+l.length+", tbxId="+n+", frmUrl="+b+", pageUrl="+g);return null}}else{console.log("[148] StgObj_ParseErr: tbxId="+n+", frmUrl="+b+", pageUrl="+g);return null}}}else{console.log("[149] StgObj_ParseErr: frmUrl="+b+", pageUrl="+g);return null}}}else{console.log("[150] StgObj_ParseErr: pageUrl="+g);return null}}m=q}else{console.log("[192] StgObj_ParseErr");return null}}catch(k){console.log("[142] StgObj_ParseErr: "+k.message);m=null}return m},_checkAndInitProp_String:function(c,e,d,a){var b=null;if(e.hasOwnProperty(d)){if(c.call(e[d])!=="[object String]"){return false}if(a){return true}else{return e[d]?true:false}}else{if(a){e[d]="";return true}}return false},_checkAndInitProp_Int:function(a,c,b){if(c.hasOwnProperty(b)){if(a.call(c[b])!=="[object Number]"){return false}return this.isInt(c[b])?true:false}return false},_checkAndInitProp_Bool:function(a,c,b){if(c.hasOwnProperty(b)){if(a.call(c[b])!=="[object Boolean]"){return false}return c[b]===true||c[b]===false}return false},isInt:function(a){return !isNaN(a)&&parseInt(Number(a))==a&&!isNaN(parseInt(a,10))},isRegExpValid:function(a){var b=true;try{new RegExp(a)}catch(c){b=false}return b},onPersistentSaveSettings:function(a){try{var c={};c[gl.gstrPersistSettingsKeyName]=gl.gSettings;chrome.storage.sync.set(c,function(){var d=null;if(chrome.runtime.lastError){d=chrome.runtime.lastError.message;d=d?d.toString():"";console.error("[185] Error saving settings: "+d)}else{d=true}if(a){a(d)}})}catch(b){gl.logExceptionReport(186,b);if(a){a("[187] Exception: "+b.message)}}},onPersistentLoadSettings:function(a){try{chrome.storage.sync.get(gl.gstrPersistSettingsKeyName,function(d){var e=null;if(chrome.runtime.lastError){e=chrome.runtime.lastError.message;e=e?e.toString():"";console.error("[190] Error loading settings: "+e)}else{var f=d[gl.gstrPersistSettingsKeyName];if(f){var c=gl.checkAndInstantiateObjSettings(f);if(c){gl.gSettings=c;e=true}else{e="[196] Parse error"}}else{gl.gSettings=$.extend(true,{},gl.gSettings_Default);e=true}}if(a){a(e)}})}catch(b){gl.logExceptionReport(188,b);if(a){a("[189] Exception: "+b.message)}}},onAfterPersistentSettingsChange:function(a,c){try{if(!a){a={}}if(!c){c={}}if(a.bIncogCollectData!==c.bIncogCollectData||a.nViewIncogData!==c.nViewIncogData||a.bUseNativeScrollbars!==c.bUseNativeScrollbars){gl.closeAllPopupWindows()}if(a.bIncogCollectData!==c.bIncogCollectData){gl.updateIconAndBadge_AllTabs()}if(a.bIncogSavePersistStorage!==c.bIncogSavePersistStorage){gl.onPersistentSaveStorage(true)}}catch(b){gl.logExceptionReport(207,b)}},onPersistentLoadStorage:function(b){var a=false;try{var d=gl.gSettings.nPersistStorageType;switch(d){case 0:a="Not used";break;case 1:var g=localStorage.getItem(gl.gstrPersistStorageKeyName);if(g){var c=gl.checkAndInstantiateObjStorage(g,true);if(c){gl.setStorageObject(c,false);a=true}else{console.error("[138] Failed to parse persistent storage data. Contents will be discarded. Contact developers at "+gl.gstrDevContact)}}else{a="No data"}break;case 2:chrome.storage.local.get(gl.gstrPersistStorageKeyName,function(e){var h=false;if(chrome.runtime.lastError){console.log("[140] Failed to read persistent storage: "+chrome.runtime.lastError.message)}else{if(e[gl.gstrPersistStorageKeyName]){var i=gl.checkAndInstantiateObjStorage(e[gl.gstrPersistStorageKeyName],false);if(i){gl.setStorageObject(i,false);h=true}else{console.error("[139] Failed to parse persistent storage data. Contents will be discarded. Contact developers at "+gl.gstrDevContact)}}else{h="No data"}}if(b){b(h)}return});return;break}}catch(f){gl.logExceptionReport(136,f);a=null}if(b){b(a)}},getDeepCopyStorage:function(b){if(b){return $.extend(true,{},gl.oStorage)}var d={};for(var c in gl.oStorage){var a=gl.oStorage[c];if(!(a.flg&2)){d[c]=$.extend(true,{},a)}}return d},onPersistentSaveStorage:function(c,b){var d=gl.gSettings.nPersistStorageType;if(d!=0){if(c||gl.gbMod_oStorage){var a=gl.getDeepCopyStorage(gl.gSettings.bIncogSavePersistStorage);a["<ver>"]=gl.getThisAppVersion();gl._persistSaveIteration(a,gl.gstrPersistStorageKeyName,d,gl._savePersistStrgCallback,b,0)}}else{if(b){b(true)}}},_savePersistStrgCallback:function(a,b){if(a===true){gl.gbMod_oStorage=false;console.log(gl.getCurrentTimeUTC()+": Saved data in persistent storage, type="+gl.gSettings.nPersistStorageType)}else{console.error("[135] FAILED to save data in persistent storage for type="+gl.gSettings.nPersistStorageType+": "+a)}if(b){b(a)}},_persistSaveIteration:function(j,a,c,d,f,g){var i=null;try{if(g<1000){switch(c){case 1:localStorage.setItem(a,JSON.stringify(j));if(d){d(true,f)}return;break;case 2:var b={};b[a]=j;chrome.storage.local.set(b,function(){if(chrome.runtime.lastError){var e=chrome.runtime.lastError?chrome.runtime.lastError.message:"";e=e?e.toString():"";if(/QUOTA_BYTES/gi.test(e)){console.log("[126] PersistStorageSaving: Exceeded quota, iteration: "+g);gl._persistShrinkIteration(j,a,c,d,f,g);return}else{if(d){d(e,f)}}}else{if(d){d(true,f)}}return});return;break;default:i="[125] PersistStorageSaving ERR: Bad type="+c;break}}else{i="[128] PersistStorageSaving ERR: Too many iterations, "+g}}catch(h){if(h.name=="QuotaExceededError"){console.log("[127] PersistStorageSaving: Exceeded quota, iteration: "+g);gl._persistShrinkIteration(j,a,c,d,f,g);return}else{i="[124] PersistStorageSaving ERR: "+h.message}}if(d){d(i,f)}},_persistShrinkIteration:function(f,u,o,h,t,c){var s=null;try{var g=false;for(var m in f){var q=f[m];for(var k in q.frms){var b=q.frms[k];for(var d in b){var a=b[d].tx;if(a.length>1){var l=0;var j=a[l].tm;for(var n=1;n<a.length;n++){if(a[n].tm<j){j=a[n].tm;l=n}}a.splice(l,1);g=true}}}}if(!g){if(Object.keys(f).length>1){var j=9007199254740992;var p=null;for(var m in f){var q=f[m];if(p===null||q.tm<j){j=q.tm;p=m}}delete f[p];g=true}}if(g){window.setTimeout(function(){gl._persistSaveIteration(f,u,o,h,t,c+1)},0);return}else{s="[134] PersistStorageSaving ERR: Cannot remove more data"}}catch(r){gl.logExceptionReport(129,r);s="[131] PersistStorageSaving ERR: "+r.message}if(h){h(s,t)}},callAsync2:function(a,c,b){if(a){window.setTimeout(function(){a(c,b)},0)}},checkTabIDValid:function(b,a){chrome.browserAction.getBadgeText({tabId:b},function(d){var c=chrome.runtime.lastError;if(a){a(!c)}})},onInstallUpdate:function(){gl.onPersistentSaveStorage(true,function(a){chrome.runtime.reload()})},onFirstInstall:function(){gl.openAppInfoWindow()},getSettingsForContent:function(){return{nCollectFlgs:gl.gSettings.nCollectFlgs,nCollectMax:gl.gSettings.nMaxTxBxNum,bCollectData:gl.gSettings.bCollectData,bIncogCollectData:gl.gSettings.bIncogCollectData}},getMaxPersistStorageSize:function(b){var a=0;if(b==1){a=5242880}else{if(b==2){a=chrome.storage.local.QUOTA_BYTES;a=gl.isInt(a)?a:0}}return a},getCurrentPersistStorageUsage:function(c,a){if(c==1){var d=0;for(var b in localStorage){d+=localStorage[b].length}if(a){a(d)}}else{if(c==2){chrome.storage.local.getBytesInUse(null,function(e){var f=-1;if(chrome.runtime.lastError){console.error("[153] ERR: "+chrome.runtime.lastError.message)}else{f=e}if(a){a(f)}})}}},getLastVisitedURL:function(){return gl.gstrLastVisitedTabURL},popupWindowShown:function(a){try{}catch(b){gl.logExceptionReport(104,b)}},encodeHtml:function(a){if(!a){return""}return a.replace(/\"|\&|\n|\r|[\u00A0-\u9999<>\&]/gim,function(b){return"&#"+b.charCodeAt(0)+";"})},getUrlPathOnly:function(c){if(!c){return""}var b=document.createElement("a");b.href=c;var d=b.protocol+"//"+b.host+b.pathname;return c.indexOf(b.hostname)!=-1?d:""},getUrlParams:function(d){var g={};if(d){var c=document.createElement("a");c.href=d;var b=c.search.replace(/^\?/,"").split("&");if(b){var f;for(var e=0;e<b.length;e++){f=b[e].split("=");if(f.length==2){g[decodeURIComponent(f[0])]=decodeURIComponent(f[1])}else{if(f.length==1&&f[0]){g[decodeURIComponent(f[0])]=""}}}}}return g},getCurrentTimeUTC:function(){var a=new Date();return a.getTime()+a.getTimezoneOffset()*60000},getThisAppVersion:function(){if(gl.__gstr_ver===null){try{var a=chrome.runtime.getManifest();strVer=a.version;gl.__gstr_ver=strVer?strVer.toString():""}catch(b){gl.logExceptionReport(137,b);gl.__gstr_ver=""}}return gl.__gstr_ver},__gstr_ver:null,replaceNewLines:function(b){if(!b){b=""}var a=gl.gSettings.nCopySubstNewLines;if(a==1){b=b.replace(/\r\n|\n\r|\n|\r/g,"\r\n")}else{if(a==2){b=b.replace(/\r\n|\n\r|\n|\r/g,"\n")}else{if(a==3){b=b.replace(/\r\n|\n\r|\n|\r/g,"\r")}}}return b},isPositiveInteger:function(a){return/^\d+$/.test(a)},normalizeVersion:function(a){if(!a){return""}return a.replace(/[^\d\.]/g,"")},compareVersions:function(f,e){if(f===null||f===undefined||e===null||e===undefined){return NaN}var d=gl.normalizeVersion(f).trim().split(".");var c=gl.normalizeVersion(e).trim().split(".");function b(h){for(var g=0;g<h.length;++g){if(!gl.isPositiveInteger(h[g])){return false}}return true}if(!b(d)||!b(c)){return NaN}for(var a=0;a<d.length;++a){if(c.length===a){return 1}if(d[a]===c[a]){continue}if(d[a]>c[a]){return 1}return -1}if(d.length!=c.length){return -1}return 0},toggleException:function(c,h,e){var g=false;var b=gl.checkUrlExceptions(c);if(b===null){if(gl.gSettings.arrExcepts.length<gl.gnMaxExcepts){var f=null;if(h==1){var a=c.match(/^(?:http|https)\:\/\/(?:www\.)?([^\/:]+)(?:[^:]*:\d+)?([^?#]+)/i);if(a&&a.length>2){f=a[1].toString()+a[2].toString()}if(f){gl.gSettings.arrExcepts.push({mt:f.toString().toLowerCase(),rx:false,tp:3});g=true}else{console.warn("[262] Can't add page exception for the URL: "+c)}}else{var a=c.match(/^(?:http|https)\:\/\/(?:www\.)?([^\/?#:]+)/i);if(a&&a.length>1){f=a[1]}if(f){gl.gSettings.arrExcepts.push({mt:f.toString().toLowerCase(),rx:false,tp:1});g=true}else{console.warn("[261] Can't add host name exception for the URL: "+c)}}}else{console.warn("[260] Too many exceptions ("+gl.gSettings.arrExcepts.length+"), can't add another one: "+c)}}else{gl.gSettings.arrExcepts.splice(b,1);for(var d=gl.gSettings.arrExcepts.length-1;d>=0;d--){b=gl.checkUrlExceptions(c);if(b===null){break}gl.gSettings.arrExcepts.splice(b,1)}g=true}if(g){gl.onPersistentSaveSettings(function(i){if(i!==true){console.error("[263] Failed to save settings: "+i)}})}if(e===true){gl.updateInfoFromActiveTab()}},determinePlatform:function(b){try{gl.gPlatform=0;if(chrome.runtime.getPlatformInfo){chrome.runtime.getPlatformInfo(function(d){gl.gOSInfo.os=d.os;gl.gOSInfo.arc=d.arch;if(d.os=="mac"){gl.gPlatform=1}else{if(d.os=="win"){gl.gPlatform=2}else{if(d.os=="linux"){gl.gPlatform=3}}}if(b){b(true)}})}else{var a=navigator.platform;gl.gOSInfo.os=a;gl.gOSInfo.arc="";if(/\bmac/gi.test(a)){gl.gPlatform=1}else{if(/\bwin/gi.test(a)){gl.gPlatform=2}else{if(/\blinux/gi.test(a)){gl.gPlatform=3}}}if(b){b(true)}}}catch(c){gl.logExceptionReport(115,c);if(b){b("[249] Err: "+c.message)}}},setTimer_FormDataCollection:function(){if(gl.__gnTimerID_FrmDtaCol){window.clearInterval(gl.__gnTimerID_FrmDtaCol);gl.__gnTimerID_FrmDtaCol=null}var a=parseInt(gl.gSettings.nCollectFormDataFreqMs,10);if(isNaN(a)||a<1000){a=1000}gl.__gnTimerID_FrmDtaCol=window.setInterval(gl.updateInfoFromActiveTab,a);console.log("[246] Set data collection timer to "+a)},__gnTimerID_FrmDtaCol:null,setTimer_PersistDataSave:function(){if(gl.__gnTimerID_PrstDtaSv){window.clearInterval(gl.__gnTimerID_PrstDtaSv);gl.__gnTimerID_PrstDtaSv=null}var a=parseInt(gl.gSettings.nSavePersistDataFreqMs,10);if(isNaN(a)||a<1000){a=1000}gl.__gnTimerID_PrstDtaSv=window.setInterval(function(){gl.onPersistentSaveStorage(false)},a);console.log("[247] Set persistent storage save timer to "+a)},__gnTimerID_PrstDtaSv:null,reinjectCSIntoAllTabs:function(){try{var a=chrome.runtime.getManifest();var c=a.content_scripts[0];chrome.windows.getAll({populate:true},function(e){for(var d=0;d<e.length;d++){var g=e[d].tabs;for(var f=0;f<g.length;f++){(function(){var h=g[f];var j=h.url;try{chrome.tabs.executeScript(h.id,{file:c.js[0],allFrames:c.all_frames,matchAboutBlank:c.match_about_blank},function(k){if(chrome.runtime.lastError){}})}catch(i){}})()}}})}catch(b){gl.logExceptionReport(156,b)}},updateOptionsPage:function(){try{var a=chrome.extension.getURL("options.html");chrome.tabs.query({url:a},function(d){for(var c=0;c<d.length;c++){chrome.tabs.sendMessage(d[c].id,{action:"update03"},function(e){if(chrome.runtime.lastError){}})}})}catch(b){gl.logExceptionReport(228,b)}},getLangEngNameByLangID:function(c){c=c?c.toString().toLowerCase():"";var b=gl.getFullUILangList();var a=b[c];return a?a:""},getFullUILangList:function(){return{ar:"Arabic",am:"Amharic",bg:"Bulgarian",bn:"Bengali",ca:"Catalan",cs:"Czech",da:"Danish",de:"German",el:"Greek",en:"English",en_gb:"English (Great Britain)",en_us:"English (USA)",es:"Spanish",es_419:"Spanish (Latin America and Caribbean)",et:"Estonian",fa:"Persian",fi:"Finnish",fil:"Filipino",fr:"French",gu:"Gujarati",he:"Hebrew",hi:"Hindi",hr:"Croatian",hu:"Hungarian",id:"Indonesian",it:"Italian",ja:"Japanese",kn:"Kannada",ko:"Korean",lt:"Lithuanian",lv:"Latvian",ml:"Malayalam",mr:"Marathi",ms:"Malay",nl:"Dutch",no:"Norwegian",pl:"Polish",pt_br:"Portuguese (Brazil)",pt_pt:"Portuguese (Portugal)",ro:"Romanian",ru:"Russian",sk:"Slovak",sl:"Slovenian",sr:"Serbian",sv:"Swedish",sw:"Swahili",ta:"Tamil",te:"Telugu",th:"Thai",tr:"Turkish",uk:"Ukrainian",vi:"Vietnamese",zh_cn:"Chinese (China)",zh_tw:"Chinese (Taiwan)"}},getAcceptedLangIDs:function(a){chrome.i18n.getAcceptLanguages(function(b){var d;for(var c=0;c<b.length;c++){d=b[c];b[c]=d?d.toString().toLowerCase().replace(/-/g,"_"):""}if(a){a(b)}})},getSupportedLangIDs:function(c,a,b){try{chrome.runtime.getPackageDirectoryEntry(function(e){e.getDirectory("_locales",{create:false},function(h){var g=h.createReader();var f=[];var i=function(){g.readEntries(function(l){if(!l.length){if(c){c(true,!b?f:f.sort())}}else{var j=function(o){return Array.prototype.slice.call(o||[],0)};var m=j(l);var n;for(var k=0;k<m.length;k++){n=m[k];n=n&&n.name?n.name.toString():"";if(a){n=n.toLowerCase().replace(/-/g,"_")}m[k]=n}f=f.concat(m);i()}},function(j){if(c){c("[295] ERR: "+j.name+". Path='"+h.fullPath+"' "+j.message,[])}})};i()},function(f){if(c){c("[294] ERR: "+f.name+". "+f.message,[])}})})}catch(d){gl.logExceptionReport(293,d);if(c){c("[296] ERR: "+d.message,[])}}},getLangUIAsJSON:function(d,a){try{if(d){var c=new XMLHttpRequest();c.open("GET",chrome.runtime.getURL("/_locales/"+d+"/messages.json"),true);c.onreadystatechange=function(){try{if(c.readyState==4){if(c.status==200){var f=JSON.parse(c.responseText.toString().replace(/\t/g," "));if(a){a(true,f)}}else{if(a){a("[303] ERR: Status="+c.status,{})}}}}catch(g){gl.logExceptionReport(301,g);if(a){a("[302] ERR: "+g.message,{})}}};c.send()}else{if(a){a("[300] Bad LangID",{})}}}catch(b){gl.logExceptionReport(298,b);if(a){a("[299] ERR: "+b.message,{})}}},_sanitizeUrl:function(b){b=b?b.trim():"";if(!b){return""}if(b=="."){return b}var a;a=b.match(/\b(?:[\d_]+>)?(about\:|chrome-extension\:\/\/){1}/i);if(a&&a.length>1){return b}a=b.match(/\b((?:[\d_]+>)?.+?\:\/\/(?:www\.)?)/i);if(a){return a[1]+" ... <Len:"+b.length+">"}return"<len="+b.length+">"},_sanitizeUrlsInStr:function(a){if(!a){return""}return a.replace(/(\S+\:\/\/(?:www\.)?)(?:\S+)/gi,"$1 ...")},getSettingsExport:function(a,f,c,d){try{var b=c!==true?JSON.stringify(gl.gSettings):JSON.stringify(gl.gSettings,null,"   ");var h='/*##[ %nm%="'+gl.gstrAppName+'"; %tp%="'+a+'"; %ver%="'+gl.getThisAppVersion()+'"; %dt%="'+gl.getCurrentTimeUTC()+'"; ]##*/\n';b=h+b;if(f){gl.getCurrentPersistStorageUsage(1,function(e){gl.getCurrentPersistStorageUsage(2,function(v){try{var s=$.extend(true,{},gl.oTabsData);if(f==1){for(var o in s){var m=s[o];m.pageURL=gl._sanitizeUrl(m.pageURL);var A=m.pageData.ttl;if(A){m.pageData.ttl="<len="+A.length+">"}m.pageData.fav=gl._sanitizeUrl(m.pageData.fav);var n=m.pageData.frms;var u={};var z=0;for(var j in n){var i=n[j];var B=i.dta;if(B){for(var p=0;p<B.length;p++){var q=B[p].val;if(q){B[p].val="<len="+q.length+">"}}}var r=gl._sanitizeUrl(j)+" <:"+z+">";z++;u[r]=n[j]}delete m.pageData.frms;m.pageData.frms=u}}var x=gl.getMaxPersistStorageSize(1);var w=gl.getMaxPersistStorageSize(2);var l={persistStgMaxSz_1:x,persistStgUsgBytes_1:e,persistStgUsgPerc_1:x>0&&e>=0?e*100/x:"-",persistStgMaxSz_2:w,persistStgUsgBytes_2:v,persistStgUsgPerc_2:w>0&&v>=0?v*100/w:"-",bEnabledCollect:gl.oBadge?gl.oBadge.bEnabledCollect:"-",gnMaxExcepts:gl.gnMaxExcepts,oStorage_Len:Object.keys(gl.oStorage).length,gbMod_oStorage:gl.gbMod_oStorage,oTabsData_Len:Object.keys(gl.oTabsData).length,oTabsData:s};var k=c!==true?JSON.stringify(l):JSON.stringify(l,null,"   ");k='\n\n/*##[ %tp%="memObjReport"; ]##*/\n'+k;k+='\n\n/*##[ %tp%="consoleReport"; %cnt%="'+gl.gConsoleCache.length+'" ]##*/\n'+gl.getConsoleCacheAsStr(f==2);if(d){d(b+k)}}catch(y){gl.logExceptionReport(306,y);if(d){d(null)}}})})}else{if(d){d(b)}}}catch(g){gl.logExceptionReport(307,g);if(d){d(null)}}},openURL:function(a){try{if(a){a=a.trim();if(a){if(!a.match(/^.*\:\/\//)){a="http://"+a}chrome.tabs.create({url:a})}}}catch(b){gl.logExceptionReport(304,b)}},openFAQPageIfNotOpened:function(a){gl.openPageIfNotOpened("http://dennisbabkin.com/php/faq.php?what=formalizr"+(a?"#"+a:""))},openContactPageIfNotOpened:function(a,b){gl.getAcceptedLangIDs(function(f){var e=new Date();var k="";for(var h=0;h<f.length;h++){if(k){k+=", "}k+=f[h]}var j=chrome.i18n.getMessage("@@ui_locale");var c="DATE: "+e.getFullYear()+"-"+(e.getMonth()+1).toString()+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()+" ("+(-e.getTimezoneOffset()/60).toString()+"h)\nOS: "+gl.gOSInfo.os+(gl.gOSInfo.arc?", BRWSR: "+gl.gOSInfo.arc:"")+"\nUI: ["+j+"] "+k;if(b){c=b.trim()+"\n"+c}var g="http://www.dennisbabkin.com/sfb/";var l={what:a?"glitch":"info",name:gl.gstrAppName,ver:gl.getThisAppVersion(),desc:c};var d="?what="+encodeURIComponent(l.what)+"&name="+encodeURIComponent(l.name)+"&ver="+encodeURIComponent(l.ver)+"&desc="+encodeURIComponent(l.desc);if(g.length+d.length<256){gl.openPageIfNotOpened(g,d)}else{gl.openPageAsPost(g,l)}})},openPageAsPost:function(b,f,h){try{var d=document.createElement("form");d.action=b;d.method="POST";d.target=h||"_blank";if(f){for(var c in f){var a=document.createElement("input");a.type="hidden";a.name=c;a.value=f[c];d.appendChild(a)}}d.style.display="none";document.body.appendChild(d);d.submit();document.body.removeChild(d)}catch(g){gl.logExceptionReport(313,g)}},openPageIfNotOpened:function(a,c){try{chrome.tabs.query({url:a+"*"},function(d){if(d.length){chrome.windows.getCurrent({populate:false},function(f){var e=d[0];if(f.id!=e.windowId){chrome.windows.update(e.windowId,{focused:true})}chrome.tabs.update(e.id,{active:true})})}else{chrome.tabs.create({url:a+(c?c:"")})}})}catch(b){gl.logExceptionReport(180,b)}},openAppSettingsWindow:function(a){gl.openPageIfNotOpened(chrome.extension.getURL("options.html"),a?"?p="+encodeURIComponent(a):null)},openGeneralSettingsWindow:function(){gl.openPageIfNotOpened("chrome://extensions/")},openAppInfoWindow:function(a){gl.openPageIfNotOpened(chrome.extension.getURL("info.html"),a?"?p="+encodeURIComponent(a):null)},defineDefaultSettings:function(){if(!gl.__gDefSttgsDefnd){gl.__gDefSttgsDefnd=true;gl.gSettings.appVersion=gl.getThisAppVersion();gl.gSettings_Default=$.extend(true,{},gl.gSettings);var a="";switch(gl.gPlatform){case 1:a="OS X";break;case 2:a="Windows";break;case 3:a="Linux";break;default:a="Other";break}console.log("[248] Detected platform: "+gl.gPlatform+" ("+a+"), appVer="+gl.gSettings.appVersion);switch(gl.gPlatform){case 1:gl.gSettings_Default.nCopySubstNewLines=2;break;case 2:gl.gSettings_Default.nCopySubstNewLines=1;break;case 3:gl.gSettings_Default.nCopySubstNewLines=2;break;default:gl.gSettings_Default.nCopySubstNewLines=0;break}}else{console.error("[245] Repeated calls not allowed")}},__gDefSttgsDefnd:false};gl.overrideGlobConsole();gl.determinePlatform(function(a){gl.defineDefaultSettings();gl.gSngltnPrmpts.loadSingletons();gl.onPersistentLoadSettings(function(b){if(b!==true){console.error("[200] Failed to load settings from persistent storage, reset settings to defaults: "+b)}gl.onPersistentLoadStorage(function(c){try{console.log("[141] Result instantiating global data from persistent storage: "+c+". StorageType: "+gl.gSettings.nPersistStorageType);gl.updateIconAndBadge_Default(gl.gSettings.bCollectData);chrome.runtime.onMessage.addListener(function(g,f,e){if(g.action=="update00"){e({dta:gl.getSettingsForContent(),res:99})}else{if(g.action=="update01"){gl.processFormData(g,f.tab.id)}else{if(g.action=="reqUpdate01"){gl.updateInfoFromTab(f.tab.id)}else{if(g.action=="logmsg"){console.log(g.msg)}}}}});chrome.tabs.onUpdated.addListener(function(g,f,h){try{if(f.status!="loading"){delete gl.oTabsData[g];gl.updateInfoFromTab(g)}}catch(i){gl.logExceptionReport(102,i)}});chrome.tabs.onActivated.addListener(function(f){try{gl.updateIconAndBadge_Tab(f.tabId);gl.updateInfoFromTab(f.tabId)}catch(g){gl.logExceptionReport(105,g)}});chrome.tabs.onRemoved.addListener(function(g,f){try{delete gl.oTabsData[g];gl.onPersistentSaveStorage(false)}catch(h){gl.logExceptionReport(101,h)}});chrome.storage.onChanged.addListener(function(e,g){if(e&&g=="sync"){if(gl.gstrPersistSettingsKeyName in e){console.log("[204] Settings sync data change notification");var f=e[gl.gstrPersistSettingsKeyName];window.setTimeout(function(h,i){gl.onPersistentLoadSettings(function(j){if(j===true){gl.onAfterPersistentSettingsChange(h,i)}else{console.error("[205] Settings update failed: "+j)}})},1,f.oldValue,f.newValue)}}});chrome.runtime.onUpdateAvailable.addListener(function(e){console.log("Update was detected, v."+(e?e.version:"?")+". Will attempt app restart...");gl.onInstallUpdate()});chrome.runtime.onConnect.addListener(function(e){e.onMessage.addListener(function(f){if(f.action=="init"){gl.popupWindowShown(true)}});e.onDisconnect.addListener(function(){gl.popupWindowShown(false)})});gl.setTimer_FormDataCollection();gl.setTimer_PersistDataSave();gl.reinjectCSIntoAllTabs()}catch(d){gl.logExceptionReport(175,d)}})})});chrome.runtime.onInstalled.addListener(function(b){if(b.reason=="install"){console.log("[291] First Formalizr installation, v."+gl.getThisAppVersion());gl.onFirstInstall()}else{if(b.reason=="update"){var a=gl.getThisAppVersion();if(gl.compareVersions(b.previousVersion,a)!==0){console.log("[292] Updated Formalizr from v."+b.previousVersion+" to v."+a)}}}});